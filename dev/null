var __getOwnPropNames = Object.getOwnPropertyNames;
var __commonJS = (cb, mod) => function __require() {
  return mod || (0, cb[__getOwnPropNames(cb)[0]])((mod = { exports: {} }).exports, mod), mod.exports;
};

// dist/_chunks/App-m8etSL3d.js
var require_App_m8etSL3d = __commonJS({
  "dist/_chunks/App-m8etSL3d.js"(exports2) {
    "use strict";
    Object.defineProperty(exports2, Symbol.toStringTag, { value: "Module" });
    var jsxRuntime = require("react/jsx-runtime");
    var admin2 = require("@strapi/strapi/admin");
    var reactRouterDom = require("react-router-dom");
    var designSystem = require("@strapi/design-system");
    var reactIntl = require("react-intl");
    var reactQuery = require("@tanstack/react-query");
    var react = require("react");
    var styled = require("styled-components");
    var index = require_index_D37jjv0();
    var recharts = require("recharts");
    var _interopDefault = (e) => e && e.__esModule ? e : { default: e };
    var styled__default = /* @__PURE__ */ _interopDefault(styled);
    var pulseInfo = styled.keyframes`
  0%, 100% { opacity: 1; }
  50% { opacity: .5; }
`;
    var DashboardContainer = styled__default.default.div`
  min-height: 100vh;
  width: 100%;
  background-color: ${({ theme }) => theme.colors.neutral100};
  color: ${({ theme }) => theme.colors.neutral800};
  display: flex;
  flex-direction: column;
`;
    var Header$1 = styled__default.default.header`
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 1rem 1.5rem;
  border-bottom: 1px solid ${({ theme }) => theme.colors.neutral150};
  background-color: ${({ theme }) => theme.colors.neutral0};
`;
    var HeaderLeft = styled__default.default.div`
  display: flex;
  align-items: center;
  gap: 0.75rem;
`;
    var IconBox = styled__default.default.div`
  padding: 10px;
  border-radius: 0.75rem;
  background-color: ${({ theme }) => theme.colors.primary100};
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 1.7rem;
  color: ${({ theme }) => theme.colors.primary600};
`;
    var TitleBox = styled__default.default.div``;
    var Title = styled__default.default.h1`
  font-size: 1.5rem;
  font-weight: 600;
  letter-spacing: -0.025em;
  color: ${({ theme }) => theme.colors.neutral800};
  margin: 0;
`;
    var Subtitle = styled__default.default.p`
  font-size: 1.2rem;
  color: ${({ theme }) => theme.colors.neutral500};
  margin: 0;
`;
    var MetaText = styled__default.default.p`
  font-size: 11px;
  color: ${({ theme }) => theme.colors.neutral400};
  margin-top: 0.125rem;
`;
    var HeaderRight = styled__default.default.div`
  display: flex;
  align-items: center;
  gap: 0.75rem;
  font-size: 0.75rem;
`;
    styled__default.default.div`
  display: none;
  @media (min-width: 640px) {
    display: flex;
  }
  font-size: 12px;
  align-items: center;
  gap: 0.5rem;
  border-radius: 9999px;
  border: 1px solid ${({ theme }) => theme.colors.neutral150};
  background-color: ${({ theme }) => theme.colors.neutral0};
  padding: 0.4rem 0.5rem;
`;
    var LiveDot = styled__default.default.span`
  height: 0.5rem;
  width: 0.5rem;
  border-radius: 9999px;
  background-color: ${({ theme }) => theme.colors.success500};
  animation: ${pulseInfo} 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;
`;
    styled__default.default.span`
  font-weight: 500;
  color: ${({ theme }) => theme.colors.neutral800};
`;
    styled__default.default.span`
  color: ${({ theme }) => theme.colors.neutral400};
`;
    styled__default.default.select`
  border-radius: 9999px;
  font-size: 12px;
  background-color: ${({ theme }) => theme.colors.neutral0};
  border: 1px solid ${({ theme }) => theme.colors.neutral150};
  padding: 0.4rem 0.75rem;
  outline: none;
  color: ${({ theme }) => theme.colors.neutral600};
`;
    styled__default.default.button`
  border-radius: 9999px;
  border: 1px solid ${({ theme }) => theme.colors.neutral150};
  background-color: ${({ theme }) => theme.colors.neutral0};
  padding: 0.4rem 1rem;
  font-size: 12px;
  font-weight: 500;
  color: ${({ theme }) => theme.colors.neutral700};
  transition: background-color 0.2s;
  cursor: pointer;

  &:hover {
    background-color: ${({ theme }) => theme.colors.neutral100};
  }
`;
    var Main = styled__default.default.main`
  flex: 1;
  padding: 1rem;
  @media (min-width: 640px) {
    padding: 1.5rem;
  }
`;
    var GridContainer = styled__default.default.section`
  display: grid;
  gap: 1rem;
  @media (min-width: 1024px) {
    grid-template-columns: repeat(2, minmax(0, 1fr));
  }
`;
    var Column = styled__default.default.div`
  display: flex;
  flex-direction: column;
  gap: 1rem;
`;
    var KpiSection$1 = styled__default.default.section`
  display: flex;
  flex-direction: column;
  gap: 0.75rem;
`;
    var KpiGrid = styled__default.default.div`
  display: grid;
  gap: 0.75rem;
  @media (min-width: 640px) {
    grid-template-columns: repeat(2, minmax(0, 1fr));
  }
`;
    var Card = styled__default.default.section`
  border-radius: 1rem;
  border: 1px solid ${({ theme }) => theme.colors.neutral150};
  background-color: ${({ theme }) => theme.colors.neutral0};
  padding: 1rem;
`;
    var CardHeader = styled__default.default.div`
  display: flex;
  align-items: center;
  justify-content: space-between;
  margin-bottom: 0.75rem;
`;
    var CardTitle = styled__default.default.h2`
  font-size: 1.5rem;
  font-weight: 600;
  color: ${({ theme }) => theme.colors.neutral800};
  margin: 0;
`;
    var CardSubtitle = styled__default.default.p`
  font-size: 12px;
  color: ${({ theme }) => theme.colors.neutral500};
  margin: 0;
`;
    styled__default.default.span`
  font-size: 11px;
  color: ${({ theme }) => theme.colors.neutral400};
`;
    var CategoryGrid$1 = styled__default.default.div`
  display: grid;
  gap: 0.5rem;
  margin-bottom: 1rem;
  font-size: 11px;
  color: ${({ theme }) => theme.colors.neutral700};

  @media (min-width: 768px) {
    grid-template-columns: repeat(2, minmax(0, 1fr));
  }
  @media (min-width: 1280px) {
    grid-template-columns: repeat(4, minmax(0, 1fr));
  }
`;
    var CategoryItem = styled__default.default.div`
  position: relative;
  display: flex;
  flex-direction: column;
  gap: 0.25rem;
  border-radius: 0.75rem;
  border: 1px solid ${({ theme }) => theme.colors.neutral150};
  background-color: ${({ theme }) => theme.colors.neutral100};
  padding: 0.5rem 0.75rem;
`;
    var CategoryName = styled__default.default.p`
  font-size: 1.2rem;
  font-weight: 500;
  color: ${({ theme }) => theme.colors.neutral800};
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
  margin: 0;
`;
    var CategoryStats = styled__default.default.p`
  font-size: 11px;
  color: ${({ theme }) => theme.colors.neutral500};
  margin: 0;
`;
    styled__default.default.p`
  font-size: 11px;
  font-weight: 600;
  color: ${({ theme }) => theme.colors.success600};
  margin: 0;
`;
    var CategoryRating = styled__default.default.p`
  font-size: 11px;
  color: ${({ theme }) => theme.colors.warning600};
  display: flex;
  align-items: center;
  gap: 0.25rem;
  margin: 0;
`;
    var ChartContainer = styled__default.default.div`
  height: 16rem;
`;
    styled__default.default.div`
  display: flex;
  align-items: center;
  justify-content: space-between;
  border-radius: 0.75rem;
  border: 1px solid ${({ theme }) => theme.colors.neutral150};
  background-color: ${({ theme }) => theme.colors.neutral100};
  padding: 0.5rem 0.75rem;
  margin-bottom: 0.5rem;
`;
    styled__default.default.div`
  display: flex;
  flex-direction: column;
  gap: 0.125rem;
`;
    styled__default.default.p`
  font-size: 1.2rem;
  font-weight: 500;
  color: ${({ theme }) => theme.colors.neutral800};
  margin: 0;
`;
    styled__default.default.p`
  font-size: 1.1rem;
  color: ${({ theme }) => theme.colors.neutral500};
  margin: 0;
`;
    styled__default.default.div`
  display: flex;
  align-items: center;
  gap: 0.5rem;
`;
    styled__default.default.div`
  width: 6rem;
  height: 0.375rem;
  border-radius: 9999px;
  background-color: ${({ theme }) => theme.colors.neutral200};
  overflow: hidden;
`;
    styled__default.default.div`
  height: 100%;
  border-radius: 9999px;
  background-color: ${({ theme }) => theme.colors.success500};
  width: ${(props) => props.width || "0%"};
`;
    styled__default.default.span`
  font-size: 11px;
  padding: 0.125rem 0.5rem;
  border-radius: 9999px;
  background-color: ${({ theme }) => theme.colors.neutral0};
  color: ${({ theme }) => theme.colors.neutral600};
  border: 1px solid ${({ theme }) => theme.colors.neutral150};
`;
    styled__default.default.div`
  display: none;
  @media (min-width: 640px) {
    display: flex;
  }
  align-items: center;
  gap: 0.25rem;
  font-size: 11px;
  color: ${({ theme }) => theme.colors.neutral500};
`;
    styled__default.default.span`
  padding: 0.125rem 0.5rem;
  border-radius: 9999px;
  background-color: ${(props) => props.bg || props.theme.colors.neutral100};
  border: 1px solid ${({ theme }) => theme.colors.neutral150};
`;
    styled__default.default.div`
  display: flex;
  align-items: center;
  justify-content: space-between;
  border-radius: 0.75rem;
  border: 1px solid ${({ theme }) => theme.colors.neutral150};
  background-color: ${({ theme }) => theme.colors.neutral100};
  padding: 0.5rem 0.75rem;
  margin-bottom: 0.5rem;
`;
    styled__default.default.div`
  display: flex;
  align-items: center;
  gap: 0.5rem;
`;
    styled__default.default.span`
  font-size: 11px;
  color: ${({ theme }) => theme.colors.neutral400};
  width: 1rem;
`;
    styled__default.default.div`
  height: 1.75rem;
  width: 1.75rem;
  border-radius: 9999px;
  background-color: ${({ theme }) => theme.colors.success100};
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 11px;
  font-weight: 600;
  color: ${({ theme }) => theme.colors.success700};
`;
    styled__default.default.div`
  display: flex;
  flex-direction: column;
`;
    styled__default.default.p`
  font-size: 0.75rem;
  font-weight: 500;
  color: ${({ theme }) => theme.colors.neutral800};
  margin: 0;
`;
    styled__default.default.p`
  font-size: 11px;
  color: ${({ theme }) => theme.colors.neutral500};
  margin: 0;
`;
    styled__default.default.div`
  display: flex;
  align-items: center;
  gap: 1rem;
  font-size: 11px;
`;
    styled__default.default.div`
  text-align: right;
`;
    styled__default.default.p`
  color: ${({ theme }) => theme.colors.neutral400};
  margin: 0;
`;
    styled__default.default.p`
  font-weight: 600;
  color: ${(props) => props.color || props.theme.colors.neutral800};
  margin: 0;
`;
    var TableSection = styled__default.default.section`
  border-radius: 1rem;
  border: 1px solid ${({ theme }) => theme.colors.neutral150};
  background-color: ${({ theme }) => theme.colors.neutral0};
  overflow: hidden;
`;
    var TableHeader = styled__default.default.div`
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 0.75rem 1rem;
  border-bottom: 1px solid ${({ theme }) => theme.colors.neutral150};
  background-color: ${({ theme }) => theme.colors.neutral100};
`;
    var ActiveBadge = styled__default.default.span`
  display: inline-flex;
  align-items: center;
  gap: 0.25rem;
  border-radius: 9999px;
  background-color: ${({ theme }) => theme.colors.success100};
  padding: 0.125rem 0.5rem;
  color: ${({ theme }) => theme.colors.success600};
  border: 1px solid ${({ theme }) => theme.colors.success200};
  font-size: 11px;
`;
    styled__default.default.button`
  border-radius: 9999px;
  border: 1px solid ${({ theme }) => theme.colors.neutral150};
  background-color: transparent;
  padding: 0.125rem 0.5rem;
  color: ${({ theme }) => theme.colors.neutral600};
  font-size: 11px;
  cursor: pointer;
  &:hover {
    background-color: ${({ theme }) => theme.colors.neutral100};
  }
`;
    var TableContainer = styled__default.default.div`
  overflow-x: auto;
  ${(props) => props.maxHeight && styled.css`
    max-height: ${props.maxHeight};
    overflow-y: auto;
  `}
  ${(props) => props.minHeight && styled.css`
    min-height: ${props.minHeight};
  `}
`;
    var Table = styled__default.default.table`
  min-width: 100%;
  font-size: 1.5rem;
  border-collapse: collapse;
`;
    var Thead = styled__default.default.thead`
  background-color: ${({ theme }) => theme.colors.neutral100};
  border-bottom: 1px solid ${({ theme }) => theme.colors.neutral200};
  color: ${({ theme }) => theme.colors.neutral500};
  text-transform: uppercase;
  letter-spacing: 0.025em;
  font-size: 1.3rem;
`;
    var Th = styled__default.default.th`
  padding: 0.5rem 1rem;
  white-space: nowrap;
  text-align: ${(props) => props.align || "center"};
  font-weight: 500;
  position: sticky;
  top: 0;
  background-color: ${({ theme }) => theme.colors.neutral100};
  z-index: 1;
`;
    var Tr = styled__default.default.tr`
  transition: background-color 0.2s;
  &:hover {
    background-color: ${({ theme }) => theme.colors.neutral100};
  }
`;
    var Td = styled__default.default.td`
  padding: 0.5rem 1rem;
  white-space: nowrap;
  color: ${(props) => props.color || props.theme.colors.neutral800};
  font-family: ${(props) => props.fontFamily || "inherit"};
  font-size: ${(props) => props.fontSize || "inherit"};
  text-align: ${(props) => props.align || "center"};
  max-width: ${(props) => props.maxWidth || "none"};
  white-space: nowrap;
  overflow: ${(props) => props.truncate ? "hidden" : "visible"};
  text-overflow: ${(props) => props.truncate ? "ellipsis" : "clip"};
`;
    var StatusBadge = styled__default.default.span`
  text-transform: capitalize;
  display: inline-flex;
  align-items: center;
  gap: 0.25rem;
  border-radius: 9999px;
  padding: 0.125rem 0.5rem;
  font-size: 11px;
  border: 1px solid transparent;

  ${(props) => /Live|ongoing/i.test(props.status) && styled.css`
    background-color: ${({ theme }) => theme.colors.success100};
    color: ${({ theme }) => theme.colors.success600};
    border-color: ${({ theme }) => theme.colors.success200};
  `}
  ${(props) => /declined|missed|busy|pending/i.test(props.status) && styled.css`
    background-color: ${({ theme }) => theme.colors.danger100};
    color: ${({ theme }) => theme.colors.danger600};
    border-color: ${({ theme }) => theme.colors.danger200};
  `}
  ${(props) => /pending/i.test(props.status) && styled.css`
    background-color: ${({ theme }) => theme.colors.warning100};
    color: ${({ theme }) => theme.colors.warning600};
    border-color: ${({ theme }) => theme.colors.warning200};
  `}
  ${(props) => /completed/i.test(props.status) && styled.css`
    background-color: ${({ theme }) => theme.colors.primary100};
    color: ${({ theme }) => theme.colors.neutral800};
    border-color: ${({ theme }) => theme.colors.primary200};
  `}
`;
    var CategoryBadge = styled__default.default.span`
  display: inline-flex;
  align-items: center;
  border-radius: 9999px;
  background-color: ${({ theme }) => theme.colors.neutral100};
  padding: 0.125rem 0.5rem;
  font-size: 11px;
  color: ${({ theme }) => theme.colors.neutral700};
  border: 1px solid ${({ theme }) => theme.colors.neutral150};
`;
    styled__default.default.button`
  border-radius: 9999px;
  border: 1px solid ${({ theme }) => theme.colors.neutral150};
  background-color: transparent;
  padding: 0.125rem 0.5rem;
  font-size: 11px;
  color: ${({ theme }) => theme.colors.neutral700};
  cursor: pointer;
  &:hover {
    background-color: ${({ theme }) => theme.colors.neutral100};
  }
`;
    var RatingStars = styled__default.default.span`
  display: inline-flex;
  align-items: center;
  justify-content: center;
  border-radius: 9999px;
  background-color: ${({ theme }) => theme.colors.warning100};
  padding: 0.125rem 0.5rem;
  font-size: 11px;
  color: ${({ theme }) => theme.colors.warning600};
  border: 1px solid ${({ theme }) => theme.colors.warning200};
`;
    var KpiCardContainer = styled__default.default.div`
  border-radius: 1.25rem;
  border: 1px solid ${({ theme }) => theme.colors.neutral150};
  background-color: ${({ theme }) => theme.colors.neutral0};
  padding: 0.75rem 1.25rem;
  box-shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.05);
`;
    var KpiTop = styled__default.default.div`
  display: flex;
  align-items: center;
  justify-content: space-between;
  gap: 0.5rem;
`;
    var KpiInfo = styled__default.default.div`
  display: flex;
  flex-direction: column;
  gap: 0.4rem;
`;
    var KpiLabel = styled__default.default.div`
  display: flex;
  align-items: center;
  gap: 0.5rem;
  font-size: 14px;
  font-weight: 500;
  text-transform: uppercase;
  letter-spacing: 0.05em;
  color: ${({ theme }) => theme.colors.neutral500};
  margin: 0;
  
  svg {
    flex-shrink: 0;
  }
`;
    var KpiValue = styled__default.default.p`
  font-size: 1.8rem;
  font-weight: 700;
  color: ${({ theme }) => theme.colors.neutral800};
  margin: 0;
`;
    var KpiChartWrapper = styled__default.default.div`
  width: 5.5rem;
  height: 5.5rem;
  flex-shrink: 0;
  display: flex;
  align-items: center;
  justify-content: center;
`;
    styled__default.default.div`
  margin-top: 0.5rem;
  display: flex;
  align-items: center;
  justify-content: space-between;
  font-size: 11px;
`;
    styled__default.default.span`
  color: ${({ theme }) => theme.colors.neutral400};
`;
    styled__default.default.span`
  display: inline-flex;
  align-items: center;
  border-radius: 9999px;
  border: 1px solid transparent;
  padding: 0.125rem 0.5rem;

  ${(props) => props.tone === "emerald" && styled.css`
    background-color: ${({ theme }) => theme.colors.success100};
    color: ${({ theme }) => theme.colors.success700};
    border-color: ${({ theme }) => theme.colors.success200};
  `}
  ${(props) => props.tone === "amber" && styled.css`
    background-color: ${({ theme }) => theme.colors.warning100};
    color: ${({ theme }) => theme.colors.warning700};
    border-color: ${({ theme }) => theme.colors.warning200};
  `}
  ${(props) => props.tone === "sky" && styled.css`
    background-color: ${({ theme }) => theme.colors.primary100};
    color: ${({ theme }) => theme.colors.primary700};
    border-color: ${({ theme }) => theme.colors.primary200};
  `}
  ${(props) => props.tone === "rose" && styled.css`
    background-color: ${({ theme }) => theme.colors.danger100};
    color: ${({ theme }) => theme.colors.danger700};
    border-color: ${({ theme }) => theme.colors.danger200};
  `}
`;
    var EmptyStateContainer = styled__default.default.div`
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  padding: 3rem 1rem;
  color: ${({ theme }) => theme.colors.neutral400};
  gap: 1rem;
  width: 100%;
`;
    var EmptyStateIcon = styled__default.default.div`
  font-size: 2.5rem;
  opacity: 0.5;
`;
    var EmptyStateText = styled__default.default.p`
  font-size: 14px;
  margin: 0;
  font-weight: 500;
  color: ${({ theme }) => theme.colors.neutral500};
`;
    var EmptyStateSubText = styled__default.default.p`
  font-size: 12px;
  margin: 0;
  opacity: 0.8;
  color: ${({ theme }) => theme.colors.neutral400};
`;
    var PaginationContainer = styled__default.default.div`
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 0.75rem 1rem;
  border-top: 1px solid ${({ theme }) => theme.colors.neutral150};
  background-color: ${({ theme }) => theme.colors.neutral0};
`;
    var PaginationButton = styled__default.default.button`
  display: inline-flex;
  align-items: center;
  justify-content: center;
  padding: 0.4rem 0.75rem;
  font-size: 11px;
  font-weight: 500;
  border-radius: 0.375rem;
  border: 1px solid ${({ theme }) => theme.colors.neutral150};
  background-color: ${({ theme }) => theme.colors.neutral0};
  color: ${({ theme }) => theme.colors.neutral700};
  cursor: pointer;
  transition: all 0.2s;

  &:hover:not(:disabled) {
    background-color: ${({ theme }) => theme.colors.neutral100};
    border-color: ${({ theme }) => theme.colors.neutral200};
    color: ${({ theme }) => theme.colors.neutral800};
  }

  &:disabled {
    opacity: 0.5;
    cursor: not-allowed;
    background-color: ${({ theme }) => theme.colors.neutral100};
  }

  ${(props) => props.active && styled.css`
    background-color: ${({ theme }) => theme.colors.primary100};
    border-color: ${({ theme }) => theme.colors.primary200};
    color: ${({ theme }) => theme.colors.primary600};
    font-weight: 600;
  `}
`;
    var PaginationInfo = styled__default.default.span`
  font-size: 11px;
  color: ${({ theme }) => theme.colors.neutral500};
`;
    var FilterContainer = styled__default.default.div`
  display: flex;
  align-items: center;
  gap: 0.25rem;
  background: ${({ theme }) => theme.colors.neutral0};
  padding: 0.35rem;
  border-radius: 12px;
  border: 1px solid ${({ theme }) => theme.colors.neutral150};
  box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.05), 0 2px 4px -1px rgba(0, 0, 0, 0.03);
`;
    var FilterButton = styled__default.default.button`
  padding: 0.5rem 1rem;
  border-radius: 8px;
  font-size: 12px;
  font-weight: 500;
  color: ${(props) => props.theme.colors.neutral500};
  background-color: ${(props) => props.active ? props.theme.colors.primary100 : "transparent"};
  border: 1px solid ${(props) => props.active ? props.theme.colors.primary200 : "transparent"};
  cursor: pointer;
  transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);

  &:hover {
    background-color: ${(props) => props.active ? props.theme.colors.primary100 : props.theme.colors.neutral100};
    transform: translateY(-1px);
  }

  &:active {
    transform: translateY(0);
  }
`;
    var CustomRangeContainer = styled__default.default.div`
  display: flex;
  align-items: center;
  gap: 0.75rem;
  margin-left: 1rem;
  padding-left: 1rem;
  border-left: 1px solid ${({ theme }) => theme.colors.neutral150};
  animation: fadeIn 0.3s ease-out;

  @keyframes fadeIn {
    from { opacity: 0; transform: translateX(-10px); }
    to { opacity: 1; transform: translateX(0); }
  }
`;
    var DateInput = styled__default.default.input`
  border-radius: 8px;
  font-size: 12px;
  background-color: ${({ theme }) => theme.colors.neutral0};
  border: 1px solid ${({ theme }) => theme.colors.neutral200};
  padding: 0.4rem 0.6rem;
  outline: none;
  color: ${({ theme }) => theme.colors.neutral700};
  transition: all 0.2s;
  cursor: pointer;

  &:focus {
    border-color: ${({ theme }) => theme.colors.primary500};
    box-shadow: 0 0 0 2px ${({ theme }) => theme.colors.primary100};
  }

  &::-webkit-calendar-picker-indicator {
    cursor: pointer;
    filter: invert(0.5);
    &:hover { filter: invert(0.3); }
  }
`;
    var DateLabel = styled__default.default.span`
  font-size: 11px;
  font-weight: 600;
  text-transform: uppercase;
  color: ${({ theme }) => theme.colors.neutral400};
  letter-spacing: 0.025em;
`;
    styled__default.default.div`
  display: flex;
  flex-wrap: wrap;
  gap: 0.5rem;
  margin-top: 0.5rem;
`;
    var DropdownContainer = styled__default.default.div`
  position: relative;
  display: inline-block;
`;
    var DropdownButton = styled__default.default.button`
  display: flex;
  align-items: center;
  gap: 8px;
  padding: 8px 16px;
  background: ${({ theme }) => theme.colors.neutral0};
  border: 1px solid ${({ theme }) => theme.colors.neutral200};
  border-radius: 8px;
  font-size: 13px;
  font-weight: 500;
  color: ${({ theme }) => theme.colors.neutral700};
  cursor: pointer;
  transition: all 0.2s;

  &:hover {
    border-color: ${({ theme }) => theme.colors.primary500};
    background: ${({ theme }) => theme.colors.neutral100};
  }
`;
    var DropdownMenu = styled__default.default.div`
  position: absolute;
  top: 100%;
  right: 0;
  margin-top: 4px;
  background: ${({ theme }) => theme.colors.neutral0};
  border: 1px solid ${({ theme }) => theme.colors.neutral200};
  border-radius: 8px;
  box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
  z-index: 100;
  min-width: 200px;
  padding: 4px;
`;
    var DropdownItem = styled__default.default.div`
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 8px 12px;
  border-radius: 6px;
  font-size: 13px;
  color: ${({ theme }) => theme.colors.neutral700};
  cursor: pointer;
  transition: all 0.2s;

  &:hover {
    background: ${({ theme }) => theme.colors.neutral100};
  }
`;
    var TickIcon = styled__default.default.span`
  display: flex;
  align-items: center;
  color: ${({ theme }) => theme.colors.primary600};
`;
    styled__default.default.button`
  padding: 0.4rem 0.8rem;
  border-radius: 20px;
  font-size: 11px;
  font-weight: 600;
  cursor: pointer;
  transition: all 0.2s;
  display: flex;
  align-items: center;
  gap: 0.4rem;
  border: 1px solid transparent;

  ${({ active, status, theme }) => {
        if (!active)
          return styled.css`
      background: ${theme.colors.neutral0};
      color: ${theme.colors.neutral600};
      border: 1px solid ${theme.colors.neutral200};
      &:hover {
        background: ${theme.colors.neutral100};
      }
    `;
        switch (status) {
          case "completed":
            return styled.css`
          background: ${theme.colors.success100};
          color: ${theme.colors.success600};
          border-color: ${theme.colors.success200};
        `;
          case "declined":
          case "missed":
          case "busy":
            return styled.css`
          background: ${theme.colors.danger100};
          color: ${theme.colors.danger600};
          border-color: ${theme.colors.danger200};
        `;
          case "force complete by admin":
            return styled.css`
          background: ${theme.colors.secondary100};
          color: ${theme.colors.secondary600};
          border-color: ${theme.colors.secondary200};
        `;
          default:
            return styled.css`
          background: ${theme.colors.primary100};
          color: ${theme.colors.primary600};
          border-color: ${theme.colors.primary200};
        `;
        }
      }}
`;
    var ModalOverlay = styled__default.default.div`
  position: fixed;
  inset: 0;
  background-color: rgba(0, 0, 0, 0.5);
  backdrop-filter: blur(4px);
  display: flex;
  align-items: center;
  justify-content: center;
  z-index: 1000;
  animation: fadeIn 0.3s ease-out;

  @keyframes fadeIn {
    from { opacity: 0; }
    to { opacity: 1; }
  }
`;
    var ModalContent = styled__default.default.div`
  background-color: ${({ theme }) => theme.colors.neutral0};
  border-radius: 16px;
  box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
  width: 90%;
  max-width: 450px;
  overflow: hidden;
  border: 1px solid ${({ theme }) => theme.colors.neutral150};
  animation: slideUp 0.3s cubic-bezier(0.16, 1, 0.3, 1);

  @keyframes slideUp {
    from { transform: translateY(30px); opacity: 0; }
    to { transform: translateY(0); opacity: 1; }
  }
`;
    var ModalHeader = styled__default.default.div`
  padding: 20px 24px;
  border-bottom: 1px solid ${({ theme }) => theme.colors.neutral150};
  display: flex;
  justify-content: space-between;
  align-items: center;
  background-color: ${({ theme }) => theme.colors.neutral0};
`;
    var ModalBody = styled__default.default.div`
  padding: 24px;
  display: flex;
  flex-direction: column;
  gap: 16px;
`;
    var ModalFooter = styled__default.default.div`
  padding: 16px 24px;
  border-top: 1px solid ${({ theme }) => theme.colors.neutral150};
  display: flex;
  justify-content: flex-end;
  gap: 12px;
  background-color: ${({ theme }) => theme.colors.neutral100};
`;
    var DataRow = styled__default.default.div`
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 8px 0;
  border-bottom: 1px solid ${({ theme }) => theme.colors.neutral100};
  &:last-child {
    border-bottom: none;
  }
`;
    var DataLabel = styled__default.default.span`
  color: ${({ theme }) => theme.colors.neutral500};
  font-size: 13px;
  font-weight: 500;
`;
    var DataValue = styled__default.default.span`
  color: ${({ theme }) => theme.colors.neutral800};
  font-size: 14px;
  font-weight: 600;
  display: flex;
  align-items: center;
  gap: 8px;
`;
    var CloseButton = styled__default.default.button`
  background: none;
  border: none;
  color: ${({ theme }) => theme.colors.neutral400};
  cursor: pointer;
  padding: 6px;
  display: flex;
  align-items: center;
  justify-content: center;
  border-radius: 8px;
  transition: all 0.2s;
  &:hover {
    background-color: ${({ theme }) => theme.colors.neutral100};
    color: ${({ theme }) => theme.colors.neutral800};
  }
`;
    var ModalButton = styled__default.default.button`
  padding: 10px 20px;
  border-radius: 10px;
  font-size: 13px;
  font-weight: 600;
  cursor: pointer;
  transition: all 0.2s;
  display: inline-flex;
  align-items: center;
  justify-content: center;
  gap: 8px;
  border: 1px solid transparent;
  
  ${(props) => props.variant === "secondary" && styled.css`
    background-color: ${({ theme }) => theme.colors.neutral0};
    border-color: ${({ theme }) => theme.colors.neutral200};
    color: ${({ theme }) => theme.colors.neutral800};
    &:hover {
      background-color: ${({ theme }) => theme.colors.neutral100};
      border-color: ${({ theme }) => theme.colors.neutral300};
    }
  `}

  ${(props) => props.variant === "primary" && styled.css`
    background-color: ${({ theme }) => theme.colors.primary600};
    color: #ffffff;
    &:hover {
      background-color: ${({ theme }) => theme.colors.primary700};
    }
  `}

  ${(props) => props.variant === "danger" && styled.css`
    background-color: ${({ theme }) => theme.colors.danger100};
    border-color: ${({ theme }) => theme.colors.danger200};
    color: ${({ theme }) => theme.colors.danger600};
    &:hover {
      background-color: ${({ theme }) => theme.colors.danger200};
    }
  `}
`;
    function Header({ stats = {}, filter, onFilterChange }) {
      const { voice = {}, video = {} } = stats;
      const totalCallsToday = (voice.callsToday || 0) + (video.callsToday || 0);
      const totalDeclinedCalls = (voice.declinedCalls || 0) + (video.declinedCalls || 0);
      const droppedRate = totalCallsToday ? (totalDeclinedCalls / totalCallsToday * 100)?.toFixed(1) : 0;
      const today = (/* @__PURE__ */ new Date()).toISOString().split("T")[0];
      const savedStart = localStorage.getItem("dashboard_start_date");
      const savedEnd = localStorage.getItem("dashboard_end_date");
      console.log("\u{1F4C5} [Header] Initializing dates:", {
        from: savedStart || today,
        to: savedEnd || today,
        source: savedStart ? "localStorage" : "default"
      });
      const [startDate, setStartDate] = react.useState(savedStart || today);
      const [endDate, setEndDate] = react.useState(savedEnd || today);
      react.useEffect(() => {
        if (startDate)
          localStorage.setItem("dashboard_start_date", startDate);
        if (endDate)
          localStorage.setItem("dashboard_end_date", endDate);
      }, [startDate, endDate]);
      react.useEffect(() => {
        if (filter === "custom" && startDate && endDate) {
          onFilterChange("custom", { start: startDate, end: endDate });
        }
      }, [startDate, endDate, filter]);
      const handlePresetChange = (preset) => {
        onFilterChange(preset);
      };
      return /* @__PURE__ */ jsxRuntime.jsxs(Header$1, {
        children: [
        /* @__PURE__ */ jsxRuntime.jsxs(HeaderLeft, {
          children: [
          /* @__PURE__ */ jsxRuntime.jsx(IconBox, { children: /* @__PURE__ */ jsxRuntime.jsx(index.PluginIcon, { style: { width: "32px", height: "32px" } }) }),
          /* @__PURE__ */ jsxRuntime.jsxs(TitleBox, {
            children: [
            /* @__PURE__ */ jsxRuntime.jsx(Title, { children: "Live Calls Dashboard" }),
            /* @__PURE__ */ jsxRuntime.jsx(Subtitle, { children: "Realtime view of ConsultEase calls, categories & expert load." }),
            /* @__PURE__ */ jsxRuntime.jsxs(MetaText, {
              children: [
                totalCallsToday,
                " calls today \u2022 ",
                totalDeclinedCalls,
                " declined (",
                droppedRate,
                "%)"
              ]
            })
            ]
          })
          ]
        }),
        /* @__PURE__ */ jsxRuntime.jsx(HeaderRight, {
          children: /* @__PURE__ */ jsxRuntime.jsxs(FilterContainer, {
            children: [
              ["60min", "today", "yesterday", "week"].map((preset) => /* @__PURE__ */ jsxRuntime.jsx(
                FilterButton,
                {
                  active: filter === preset,
                  onClick: () => handlePresetChange(preset),
                  children: preset === "60min" ? "60 Minutes" : preset.charAt(0).toUpperCase() + preset.slice(1)
                },
                preset
              )),
          /* @__PURE__ */ jsxRuntime.jsx(
                FilterButton,
                {
                  active: filter === "custom",
                  onClick: () => handlePresetChange("custom"),
                  children: "Custom Range"
                }
              ),
              filter === "custom" && /* @__PURE__ */ jsxRuntime.jsxs(CustomRangeContainer, {
                children: [
            /* @__PURE__ */ jsxRuntime.jsx(DateLabel, { children: "From" }),
            /* @__PURE__ */ jsxRuntime.jsx(
                  DateInput,
                  {
                    type: "date",
                    value: startDate,
                    onChange: (e) => setStartDate(e.target.value)
                  }
                ),
            /* @__PURE__ */ jsxRuntime.jsx(DateLabel, { children: "To" }),
            /* @__PURE__ */ jsxRuntime.jsx(
                  DateInput,
                  {
                    type: "date",
                    value: endDate,
                    onChange: (e) => setEndDate(e.target.value)
                  }
                )
                ]
              })
            ]
          })
        })
        ]
      });
    }
    var getDateRange = (filter, customRange) => {
      const now = /* @__PURE__ */ new Date();
      let start = /* @__PURE__ */ new Date();
      let end = /* @__PURE__ */ new Date();
      if (filter === "custom" && customRange?.start && customRange?.end) {
        return {
          start: new Date(customRange.start).toISOString(),
          end: new Date(new Date(customRange.end).setHours(23, 59, 59, 999)).toISOString()
        };
      }
      if (filter === "60min") {
        start = new Date(now.getTime() - 60 * 60 * 1e3);
        return { start: start.toISOString(), end: now.toISOString() };
      }
      if (filter === "yesterday") {
        start.setDate(now.getDate() - 1);
        start.setHours(0, 0, 0, 0);
        end.setDate(now.getDate() - 1);
        end.setHours(23, 59, 59, 999);
        return { start: start.toISOString(), end: end.toISOString() };
      }
      if (filter === "week") {
        start.setDate(now.getDate() - 7);
        return { start: start.toISOString(), end: now.toISOString() };
      }
      start.setHours(0, 0, 0, 0);
      return { start: start.toISOString(), end: now.toISOString() };
    };
    var useCompletedCalls = (page = 1, filter = "60min", liveCalls, customRange, statuses = []) => {
      const { get } = admin2.useFetchClient();
      const { start, end } = getDateRange(filter, customRange);
      let statusFilter = "";
      if (statuses.length > 0) {
        statusFilter = statuses.map((status, index2) => `&filters[callStatus][$in][${index2}]=${status}`).join("");
      } else {
        statusFilter = "&filters[callStatus][$notIn][0]=pending&filters[callStatus][$notIn][1]=ongoing";
      }
      const api = `/admin-pannel/recent-calls?filters[createdAt][$gte]=${encodeURIComponent(start)}&filters[createdAt][$lte]=${encodeURIComponent(end)}${statusFilter}&pagination[page]=${page}&pagination[pageSize]=20`;
      const { data, ...rest } = reactQuery.useQuery({
        queryKey: ["completed-calls", page, filter, liveCalls, customRange, statuses],
        enabled: liveCalls !== void 0,
        queryFn: async () => {
          const { data: data2 } = await get(api);
          return data2;
        }
      });
      return { data: data?.data, meta: data?.meta || {}, ...rest };
    };
    var useCategoryStats = (filter = "today", liveCalls, customRange) => {
      const { get } = admin2.useFetchClient();
      const { start, end } = getDateRange(filter, customRange);
      const api = `/admin-pannel/category-stats?filters[startTime][$gte]=${encodeURIComponent(start)}&filters[startTime][$lte]=${encodeURIComponent(end)}`;
      return reactQuery.useQuery({
        queryKey: ["category-stats", filter, liveCalls, customRange],
        enabled: liveCalls !== void 0,
        queryFn: async () => {
          const { data } = await get(api);
          return data;
        }
      });
    };
    var useStreamData = () => {
      const [liveData, setLiveData] = react.useState();
      console.log(window.strapi?.backendURL);
      react.useEffect(() => {
        const eventSource = new EventSource(`${window.strapi?.backendURL}/admin-pannel/stream`);
        eventSource.onmessage = function (event) {
          const data = JSON.parse(event.data);
          setLiveData(data);
        };
        eventSource.onerror = function (error) {
          console.error("SSE connection error:", error);
        };
        return () => {
          eventSource.close();
        };
      }, []);
      return liveData;
    };
    function EmptyState({ title, subtitle, icon = "\u{1F4ED}" }) {
      return /* @__PURE__ */ jsxRuntime.jsxs(EmptyStateContainer, {
        children: [
        /* @__PURE__ */ jsxRuntime.jsx(EmptyStateIcon, { children: icon }),
        /* @__PURE__ */ jsxRuntime.jsx(EmptyStateText, { children: title }),
          subtitle && /* @__PURE__ */ jsxRuntime.jsx(EmptyStateSubText, { children: subtitle })
        ]
      });
    }
    function minutesToMMSS(minutes) {
      if (minutes == null || isNaN(minutes))
        return "---";
      const totalSeconds = Math.round(minutes * 60);
      if (minutes >= 60) {
        const hh = Math.floor(totalSeconds / 3600);
        const mm2 = Math.floor(totalSeconds % 3600 / 60);
        const ss2 = totalSeconds % 60;
        return `${String(hh).padStart(2, "0")}:${String(mm2).padStart(2, "0")}:${String(ss2).padStart(2, "0")}`;
      }
      const mm = Math.floor(totalSeconds / 60);
      const ss = totalSeconds % 60;
      return `${String(mm).padStart(2, "0")}:${String(ss).padStart(2, "0")}`;
    }
    function formatTimeAMPM(dateInput) {
      if (!dateInput)
        return "";
      const date = new Date(dateInput);
      let hours = date.getHours();
      const minutes = date.getMinutes();
      const ampm = hours >= 12 ? "pm" : "am";
      hours = hours % 12 || 12;
      return `${String(hours).padStart(2, "0")}:${String(minutes).padStart(2, "0")} ${ampm}`;
    }
    function formatDateTime(dateInput) {
      if (!dateInput)
        return "---";
      const date = new Date(dateInput);
      if (isNaN(date.getTime()))
        return "---";
      const day = date.getDate();
      const month = date.toLocaleString("default", { month: "short" });
      const year = date.getFullYear();
      let hours = date.getHours();
      const minutes = date.getMinutes();
      const ampm = hours >= 12 ? "PM" : "AM";
      hours = hours % 12;
      hours = hours ? hours : 12;
      const strTime = `${String(hours).padStart(2, "0")}:${String(minutes).padStart(2, "0")} ${ampm}`;
      return `${day} ${month} ${year}, ${strTime}`;
    }
    function formatDurationFromMinutes(minutes) {
      if (!Number.isFinite(minutes) || minutes <= 0)
        return "---";
      const totalSeconds = Math.round(minutes * 60);
      const hrs = Math.floor(totalSeconds / 3600);
      const mins = Math.floor(totalSeconds % 3600 / 60);
      const secs = totalSeconds % 60;
      const parts = [];
      if (hrs > 0)
        parts.push(`${hrs}h`);
      if (mins > 0)
        parts.push(`${mins}min`);
      if (secs > 0)
        parts.push(`${secs}sec`);
      return parts.join(", ");
    }
    var CHART_COLORS = {
      voice: "#7476f1ff",
      video: "#48ecbbff"
    };
    var CustomTooltip$1 = ({ active, payload, label, theme }) => {
      if (active && payload && payload.length) {
        const data = payload[0].payload;
        return /* @__PURE__ */ jsxRuntime.jsxs("div", {
          style: {
            backgroundColor: theme.colors.neutral0,
            border: `1px solid ${theme.colors.neutral150}`,
            padding: "12px",
            borderRadius: "8px",
            boxShadow: "0 4px 6px -1px rgba(0, 0, 0, 0.1)",
            minWidth: "150px"
          }, children: [
          /* @__PURE__ */ jsxRuntime.jsx("p", {
            style: {
              fontWeight: 600,
              marginBottom: "8px",
              fontSize: "12px",
              color: theme.colors.neutral800,
              borderBottom: `1px solid ${theme.colors.neutral150}`,
              paddingBottom: "4px"
            }, children: label
          }),
          /* @__PURE__ */ jsxRuntime.jsxs("div", {
            style: { display: "flex", flexDirection: "column", gap: "4px" }, children: [
            /* @__PURE__ */ jsxRuntime.jsxs("p", {
              style: { color: CHART_COLORS.voice, fontSize: "11px", fontWeight: 600 }, children: [
                "Voice Calls: ",
                data.calls
              ]
            }),
            /* @__PURE__ */ jsxRuntime.jsxs("p", {
              style: { color: CHART_COLORS.video, fontSize: "11px", fontWeight: 600 }, children: [
                "Video Calls: ",
                data.videoCalls
              ]
            }),
            /* @__PURE__ */ jsxRuntime.jsxs("p", {
              style: { color: theme.colors.neutral600, fontSize: "11px", marginTop: "4px", borderTop: `1px solid ${theme.colors.neutral100}`, paddingTop: "4px" }, children: [
                "Total: ",
                data.totalCalls
              ]
            }),
            /* @__PURE__ */ jsxRuntime.jsxs("p", {
              style: { color: theme.colors.neutral600, fontSize: "11px" }, children: [
                "Minutes: ",
                data.minutes
              ]
            }),
            /* @__PURE__ */ jsxRuntime.jsxs("p", {
              style: { color: theme.colors.neutral600, fontSize: "11px" }, children: [
                "Avg Rating: ",
                data.avgRating,
                " \u2605"
              ]
            })
            ]
          })
          ]
        });
      }
      return null;
    };
    function CategoryGrid({ liveCalls, filter, customRange }) {
      const { data: categoryStats = [] } = useCategoryStats(filter, liveCalls, customRange);
      const theme = styled.useTheme();
      return /* @__PURE__ */ jsxRuntime.jsxs(Card, {
        children: [
        /* @__PURE__ */ jsxRuntime.jsx(CardHeader, {
          children: /* @__PURE__ */ jsxRuntime.jsxs("div", {
            children: [
          /* @__PURE__ */ jsxRuntime.jsx(CardTitle, { children: "Calls by Category" }),
          /* @__PURE__ */ jsxRuntime.jsx(CardSubtitle, { children: "Call distribution by topics" })
            ]
          })
        }),
        /* @__PURE__ */ jsxRuntime.jsx(CategoryGrid$1, {
          children: categoryStats.length === 0 ? /* @__PURE__ */ jsxRuntime.jsx("div", {
            style: { gridColumn: "1 / -1" }, children: /* @__PURE__ */ jsxRuntime.jsx(
              EmptyState,
              {
                title: "No categories found",
                subtitle: {
                  today: "There are no calls for today.",
                  yesterday: "There are no calls for yesterday.",
                  week: "There are no calls for this week."
                }[filter],
                icon: "\u{1F4CA}"
              }
            )
          }) : categoryStats.map((row) => /* @__PURE__ */ jsxRuntime.jsxs(CategoryItem, {
            children: [
          /* @__PURE__ */ jsxRuntime.jsx(CategoryName, { title: row.name, children: row.name }),
              row.calls > 0 && /* @__PURE__ */ jsxRuntime.jsxs(CategoryStats, {
                children: [
                  "Voice calls: ",
                  row.calls
                ]
              }),
              row.videoCalls > 0 && /* @__PURE__ */ jsxRuntime.jsxs(CategoryStats, {
                children: [
                  "Video calls: ",
                  row.videoCalls
                ]
              }),
          /* @__PURE__ */ jsxRuntime.jsxs(CategoryStats, {
                children: [
                  "Total: ",
                  formatDurationFromMinutes(row.minutes)
                ]
              }),
          /* @__PURE__ */ jsxRuntime.jsx("div", {
                style: { position: "absolute", bottom: "4px", right: "4px" }, children: /* @__PURE__ */ jsxRuntime.jsxs(CategoryRating, {
                  children: [
            /* @__PURE__ */ jsxRuntime.jsx("span", { children: "\u2605" }),
            /* @__PURE__ */ jsxRuntime.jsx("span", { children: row.avgRating.toFixed(2) })
                  ]
                })
              })
            ]
          }, row.name))
        }),
          categoryStats.length > 1 && /* @__PURE__ */ jsxRuntime.jsx(ChartContainer, {
            style: { height: "350px" }, children: /* @__PURE__ */ jsxRuntime.jsx(recharts.ResponsiveContainer, {
              width: "100%", height: "100%", children: /* @__PURE__ */ jsxRuntime.jsxs(recharts.BarChart, {
                data: categoryStats, barSize: 25, margin: { top: 10, right: 10, left: 0, bottom: 40 }, children: [
          /* @__PURE__ */ jsxRuntime.jsx(
                  recharts.XAxis,
                  {
                    dataKey: "name",
                    tickLine: false,
                    axisLine: false,
                    tick: { fontSize: 10, fill: theme.colors.neutral500, angle: -45, textAnchor: "end" },
                    height: 60,
                    interval: 0
                  }
                ),
          /* @__PURE__ */ jsxRuntime.jsx(recharts.YAxis, { hide: true, axisLine: false, tickLine: false }),
          /* @__PURE__ */ jsxRuntime.jsx(recharts.Tooltip, { content: /* @__PURE__ */ jsxRuntime.jsx(CustomTooltip$1, { theme }), cursor: { fill: theme.colors.neutral100 } }),
          /* @__PURE__ */ jsxRuntime.jsx(recharts.Bar, { dataKey: "calls", radius: [6, 6, 0, 0], fill: CHART_COLORS.voice }),
          /* @__PURE__ */ jsxRuntime.jsx(recharts.Bar, { dataKey: "videoCalls", radius: [6, 6, 0, 0], fill: CHART_COLORS.video })
                ]
              })
            })
          })
        ]
      });
    }
    var useMovingTime = () => {
      const [now, setNow] = react.useState(Date.now());
      react.useEffect(() => {
        const id = setInterval(() => setNow(Date.now()), 1e3);
        return () => clearInterval(id);
      }, []);
      return now;
    };
    function LiveCallsTable({ stats = {}, liveCalls = [] }) {
      const currMovingTime = useMovingTime();
      const theme = styled.useTheme();
      const { post } = admin2.useFetchClient();
      const [selectedCall, setSelectedCall] = react.useState(null);
      const closeModal = () => setSelectedCall(null);
      const handleRedirect = () => {
        if (selectedCall) {
          window.open(`/admin/content-manager/collection-types/api::call.call/${selectedCall.documentId}`, "_blank");
          closeModal();
        }
      };
      const handleDeclineCall = async () => {
        if (selectedCall) {
          try {
            await post("/admin-pannel/callend", { callId: selectedCall.id });
          } catch (error) {
            console.error("\u{1F514} [LiveCallsTable] Failed to decline call:", error);
          }
          closeModal();
        }
      };
      return /* @__PURE__ */ jsxRuntime.jsxs(TableSection, {
        children: [
        /* @__PURE__ */ jsxRuntime.jsxs(TableHeader, {
          children: [
          /* @__PURE__ */ jsxRuntime.jsxs("div", {
            children: [
            /* @__PURE__ */ jsxRuntime.jsx(CardTitle, { children: "Live calls" }),
            /* @__PURE__ */ jsxRuntime.jsx(CardSubtitle, { children: "Monitor ongoing calls." })
            ]
          }),
          /* @__PURE__ */ jsxRuntime.jsx("div", {
            style: { display: "flex", gap: "10px" }, children: /* @__PURE__ */ jsxRuntime.jsxs(ActiveBadge, {
              children: [
            /* @__PURE__ */ jsxRuntime.jsx(LiveDot, {}),
                " ",
                (stats.voice?.liveCalls || 0) + (stats.video?.liveCalls || 0),
                " ongoing"
              ]
            })
          })
          ]
        }),
        /* @__PURE__ */ jsxRuntime.jsx(TableContainer, {
          maxHeight: "350px", minHeight: "200px", children: /* @__PURE__ */ jsxRuntime.jsxs(Table, {
            children: [
          /* @__PURE__ */ jsxRuntime.jsx(Thead, {
              children: /* @__PURE__ */ jsxRuntime.jsxs("tr", {
                children: [
            /* @__PURE__ */ jsxRuntime.jsx(Th, { children: "Call ID" }),
            /* @__PURE__ */ jsxRuntime.jsx(Th, { children: "Type" }),
            /* @__PURE__ */ jsxRuntime.jsx(Th, { children: "Caller" }),
            /* @__PURE__ */ jsxRuntime.jsx(Th, { children: "Expert" }),
            /* @__PURE__ */ jsxRuntime.jsx(Th, { children: "Start Time" }),
            /* @__PURE__ */ jsxRuntime.jsx(Th, { children: "Duration" }),
            /* @__PURE__ */ jsxRuntime.jsx(Th, { children: "Category" }),
            /* @__PURE__ */ jsxRuntime.jsx(Th, { children: "Status" })
                ]
              })
            }),
          /* @__PURE__ */ jsxRuntime.jsx("tbody", {
              children: liveCalls.length === 0 ? /* @__PURE__ */ jsxRuntime.jsx("tr", {
                children: /* @__PURE__ */ jsxRuntime.jsx("td", {
                  colSpan: "8", children: /* @__PURE__ */ jsxRuntime.jsx(
                    EmptyState,
                    {
                      title: "No live calls",
                      subtitle: "Ongoing consultations will appear here."
                    }
                  )
                })
              }) : liveCalls.map((call) => /* @__PURE__ */ jsxRuntime.jsxs(
                Tr,
                {
                  style: { cursor: "pointer" },
                  onClick: () => setSelectedCall(call),
                  children: [
                /* @__PURE__ */ jsxRuntime.jsx(Td, { fontFamily: "monospace", children: call.id }),
                /* @__PURE__ */ jsxRuntime.jsx(Td, { fontSize: "1.4rem", children: call.type == "voiceCall" ? /* @__PURE__ */ jsxRuntime.jsx(index.VoiceCall, { style: { width: "20px", height: "20px", color: "#5272a3ff" } }) : /* @__PURE__ */ jsxRuntime.jsx(index.VideoCall, { style: { width: "20px", height: "20px", color: "#219bacff" } }) }),
                /* @__PURE__ */ jsxRuntime.jsx(Td, { fontSize: "1.4rem", children: call.caller }),
                /* @__PURE__ */ jsxRuntime.jsx(Td, { fontSize: "1.4rem", children: call.expert }),
                /* @__PURE__ */ jsxRuntime.jsx(Td, { fontSize: "1.4rem", children: formatTimeAMPM(call.startTime) || "---" }),
                /* @__PURE__ */ jsxRuntime.jsx(Td, { fontSize: "1.4rem", children: call.startTime ? minutesToMMSS((currMovingTime - new Date(call.startTime).getTime()) / (1e3 * 60)) : "---" }),
                /* @__PURE__ */ jsxRuntime.jsxs(Td, {
                    children: [
                      " ",
                  /* @__PURE__ */ jsxRuntime.jsx(CategoryBadge, { children: call.category })
                    ]
                  }),
                /* @__PURE__ */ jsxRuntime.jsx(Td, {
                    children: /* @__PURE__ */ jsxRuntime.jsxs(StatusBadge, {
                      status: call.status, children: [
                  /* @__PURE__ */ jsxRuntime.jsx(
                        "span",
                        {
                          style: {
                            width: 6,
                            height: 6,
                            borderRadius: "50%",
                            backgroundColor: "currentColor"
                          }
                        }
                      ),
                        call.status === "pending" ? "Calling" : call.status
                      ]
                    })
                  })
                  ]
                },
                call.id
              ))
            })
            ]
          })
        }),
          selectedCall && /* @__PURE__ */ jsxRuntime.jsx(ModalOverlay, {
            onClick: closeModal, children: /* @__PURE__ */ jsxRuntime.jsxs(ModalContent, {
              onClick: (e) => e.stopPropagation(), children: [
          /* @__PURE__ */ jsxRuntime.jsxs(ModalHeader, {
                children: [
            /* @__PURE__ */ jsxRuntime.jsxs("div", {
                  style: { display: "flex", alignItems: "center", gap: "12px" }, children: [
              /* @__PURE__ */ jsxRuntime.jsx("div", {
                    style: {
                      backgroundColor: selectedCall.type === "voiceCall" ? theme.colors.primary100 : theme.colors.success100,
                      color: selectedCall.type === "voiceCall" ? theme.colors.primary600 : theme.colors.success600,
                      padding: "8px",
                      borderRadius: "12px",
                      display: "flex"
                    }, children: selectedCall.type === "voiceCall" ? /* @__PURE__ */ jsxRuntime.jsx(index.VoiceCall, { style: { width: "24px", height: "24px" } }) : /* @__PURE__ */ jsxRuntime.jsx(index.VideoCall, { style: { width: "24px", height: "24px" } })
                  }),
              /* @__PURE__ */ jsxRuntime.jsxs("div", {
                    children: [
                /* @__PURE__ */ jsxRuntime.jsx(CardTitle, { style: { fontSize: "16px" }, children: "Call Details" }),
                /* @__PURE__ */ jsxRuntime.jsxs(CardSubtitle, {
                      style: { fontSize: "11px" }, children: [
                        "ID: ",
                        selectedCall.id
                      ]
                    })
                    ]
                  })
                  ]
                }),
            /* @__PURE__ */ jsxRuntime.jsx(CloseButton, { onClick: closeModal, children: /* @__PURE__ */ jsxRuntime.jsx(index.Cross, { style: { width: "20px", height: "20px" } }) })
                ]
              }),
          /* @__PURE__ */ jsxRuntime.jsxs(ModalBody, {
                children: [
            /* @__PURE__ */ jsxRuntime.jsxs(DataRow, {
                  children: [
              /* @__PURE__ */ jsxRuntime.jsx(DataLabel, { children: "Caller" }),
              /* @__PURE__ */ jsxRuntime.jsx(DataValue, { children: selectedCall.caller })
                  ]
                }),
            /* @__PURE__ */ jsxRuntime.jsxs(DataRow, {
                  children: [
              /* @__PURE__ */ jsxRuntime.jsx(DataLabel, { children: "Expert" }),
              /* @__PURE__ */ jsxRuntime.jsx(DataValue, { children: selectedCall.expert })
                  ]
                }),
            /* @__PURE__ */ jsxRuntime.jsxs(DataRow, {
                  children: [
              /* @__PURE__ */ jsxRuntime.jsx(DataLabel, { children: "Category" }),
              /* @__PURE__ */ jsxRuntime.jsx(DataValue, { children: /* @__PURE__ */ jsxRuntime.jsx(CategoryBadge, { children: selectedCall.category }) })
                  ]
                }),
            /* @__PURE__ */ jsxRuntime.jsxs(DataRow, {
                  children: [
              /* @__PURE__ */ jsxRuntime.jsx(DataLabel, { children: "Start Time" }),
              /* @__PURE__ */ jsxRuntime.jsx(DataValue, { children: formatTimeAMPM(selectedCall.startTime) || "---" })
                  ]
                }),
            /* @__PURE__ */ jsxRuntime.jsxs(DataRow, {
                  children: [
              /* @__PURE__ */ jsxRuntime.jsx(DataLabel, { children: "Duration" }),
              /* @__PURE__ */ jsxRuntime.jsx(DataValue, { children: selectedCall.startTime ? minutesToMMSS((currMovingTime - new Date(selectedCall.startTime).getTime()) / (1e3 * 60)) : "---" })
                  ]
                }),
            /* @__PURE__ */ jsxRuntime.jsxs(DataRow, {
                  children: [
              /* @__PURE__ */ jsxRuntime.jsx(DataLabel, { children: "Status" }),
              /* @__PURE__ */ jsxRuntime.jsx(DataValue, {
                    children: /* @__PURE__ */ jsxRuntime.jsxs(StatusBadge, {
                      status: selectedCall.status, children: [
                /* @__PURE__ */ jsxRuntime.jsx("span", { style: { width: 6, height: 6, borderRadius: "50%", backgroundColor: "currentColor" } }),
                        selectedCall.status === "pending" ? "Calling" : selectedCall.status
                      ]
                    })
                  })
                  ]
                })
                ]
              }),
          /* @__PURE__ */ jsxRuntime.jsxs(ModalFooter, {
                children: [
            /* @__PURE__ */ jsxRuntime.jsx(ModalButton, { variant: "danger", onClick: handleDeclineCall, children: "Decline Call" }),
            /* @__PURE__ */ jsxRuntime.jsx(ModalButton, { variant: "primary", onClick: handleRedirect, children: "View Details" })
                ]
              })
              ]
            })
          })
        ]
      });
    }
    var STATUS_OPTIONS = [
      { label: "Completed", value: "completed" },
      { label: "Declined", value: "declined" },
      { label: "Missed", value: "missed" },
      { label: "Busy", value: "busy" },
      { label: "Force Completed", value: "force complete by admin" }
    ];
    function RecentCallsTable({ liveCalls, filter, customRange }) {
      const [page, setPage] = react.useState(1);
      const [selectedStatuses, setSelectedStatuses] = react.useState([]);
      const [isFilterOpen, setIsFilterOpen] = react.useState(false);
      const filterRef = react.useRef(null);
      const { data: recentCalls = [], meta = {} } = useCompletedCalls(
        page,
        filter,
        liveCalls,
        customRange,
        selectedStatuses
      ) || {};
      react.useEffect(() => {
        const handleClickOutside = (event) => {
          if (filterRef.current && !filterRef.current.contains(event.target)) {
            setIsFilterOpen(false);
          }
        };
        document.addEventListener("mousedown", handleClickOutside);
        return () => document.removeEventListener("mousedown", handleClickOutside);
      }, []);
      const handleNextPage = () => {
        if (page < (meta.pagination?.pageCount || 1))
          setPage((prev) => prev + 1);
      };
      const handlePrevPage = () => {
        if (page > 1)
          setPage((prev) => prev - 1);
      };
      const toggleStatus = (status) => {
        setPage(1);
        setSelectedStatuses(
          (prev) => prev.includes(status) ? prev.filter((s) => s !== status) : [...prev, status]
        );
      };
      return /* @__PURE__ */ jsxRuntime.jsxs(TableSection, {
        children: [
        /* @__PURE__ */ jsxRuntime.jsxs(TableHeader, {
          children: [
          /* @__PURE__ */ jsxRuntime.jsxs("div", {
            children: [
            /* @__PURE__ */ jsxRuntime.jsx(CardTitle, { children: "Call Activity" }),
            /* @__PURE__ */ jsxRuntime.jsxs(CardSubtitle, {
              children: [
                "All closed calls snapshot. ",
                meta.pagination?.total ? `Total calls: ${meta.pagination?.total}` : ""
              ]
            })
            ]
          }),
          /* @__PURE__ */ jsxRuntime.jsxs(DropdownContainer, {
            ref: filterRef, children: [
            /* @__PURE__ */ jsxRuntime.jsxs(DropdownButton, {
              onClick: () => setIsFilterOpen(!isFilterOpen), children: [
                "Filter ",
                selectedStatuses.length > 0 && `(${selectedStatuses.length})`,
              /* @__PURE__ */ jsxRuntime.jsx(index.ChevronDown, {})
              ]
            }),
              isFilterOpen && /* @__PURE__ */ jsxRuntime.jsx(DropdownMenu, {
                children: STATUS_OPTIONS.map((opt) => /* @__PURE__ */ jsxRuntime.jsxs(
                  DropdownItem,
                  {
                    onClick: () => toggleStatus(opt.value),
                    children: [
                      opt.label,
                      selectedStatuses.includes(opt.value) && /* @__PURE__ */ jsxRuntime.jsx(TickIcon, { children: /* @__PURE__ */ jsxRuntime.jsx(index.Tick, {}) })
                    ]
                  },
                  opt.value
                ))
              })
            ]
          })
          ]
        }),
        /* @__PURE__ */ jsxRuntime.jsx(TableContainer, {
          maxHeight: "450px", minHeight: "200px", children: /* @__PURE__ */ jsxRuntime.jsxs(Table, {
            children: [
          /* @__PURE__ */ jsxRuntime.jsx(Thead, {
              children: /* @__PURE__ */ jsxRuntime.jsxs("tr", {
                children: [
            /* @__PURE__ */ jsxRuntime.jsx(Th, { children: "Call Id" }),
            /* @__PURE__ */ jsxRuntime.jsx(Th, { children: "Type" }),
            /* @__PURE__ */ jsxRuntime.jsx(Th, { children: "Caller" }),
            /* @__PURE__ */ jsxRuntime.jsx(Th, { children: "Expert" }),
            /* @__PURE__ */ jsxRuntime.jsx(Th, { children: "Category" }),
            /* @__PURE__ */ jsxRuntime.jsx(Th, { children: "Start Time" }),
            /* @__PURE__ */ jsxRuntime.jsx(Th, { children: "Duration" }),
            /* @__PURE__ */ jsxRuntime.jsx(Th, { children: "Status" }),
            /* @__PURE__ */ jsxRuntime.jsx(Th, { children: "Rating" })
                ]
              })
            }),
          /* @__PURE__ */ jsxRuntime.jsx("tbody", {
              children: recentCalls.length === 0 ? /* @__PURE__ */ jsxRuntime.jsx("tr", {
                children: /* @__PURE__ */ jsxRuntime.jsx("td", {
                  colSpan: "9", children: /* @__PURE__ */ jsxRuntime.jsx(
                    EmptyState,
                    {
                      title: "No completed calls",
                      subtitle: {
                        "60min": "No calls in the last 60 minutes.",
                        "today": "No calls completed today.",
                        "yesterday": "No calls completed yesterday.",
                        "week": "No calls completed this week.",
                        "custom": "No calls found for the selected range and criteria."
                      }[filter]
                    }
                  )
                })
              }) : recentCalls.map((call, idx) => /* @__PURE__ */ jsxRuntime.jsxs(
                Tr,
                {
                  style: { cursor: "pointer" },
                  onClick: () => window.open(`/admin/content-manager/collection-types/api::call.call/${call.documentId}`, "_blank"),
                  children: [
                /* @__PURE__ */ jsxRuntime.jsx(Td, { fontSize: "1.4rem", children: call.id }),
                /* @__PURE__ */ jsxRuntime.jsx(Td, { fontSize: "1.4rem", children: call.type == "voiceCall" ? /* @__PURE__ */ jsxRuntime.jsx(index.VoiceCall, { style: { width: "20px", height: "20px", color: "#5272a3ff" } }) : /* @__PURE__ */ jsxRuntime.jsx(index.VideoCall, { style: { width: "20px", height: "20px", color: "#219bacff" } }) }),
                /* @__PURE__ */ jsxRuntime.jsx(Td, { fontSize: "1.4rem", children: call.caller }),
                /* @__PURE__ */ jsxRuntime.jsx(Td, { fontSize: "1.4rem", children: call.expert }),
                /* @__PURE__ */ jsxRuntime.jsx(Td, { fontSize: "1.4rem", children: /* @__PURE__ */ jsxRuntime.jsx(CategoryBadge, { children: call.category || "Other" }) }),
                /* @__PURE__ */ jsxRuntime.jsx(Td, { fontSize: "1.4rem", children: formatDateTime(call.time) }),
                /* @__PURE__ */ jsxRuntime.jsx(Td, { fontSize: "1.4rem", children: minutesToMMSS(call.duration) }),
                /* @__PURE__ */ jsxRuntime.jsx(Td, {
                    children: /* @__PURE__ */ jsxRuntime.jsxs(StatusBadge, {
                      status: call.status, children: [
                  /* @__PURE__ */ jsxRuntime.jsx(
                        "span",
                        {
                          style: {
                            width: 6,
                            height: 6,
                            borderRadius: "50%",
                            backgroundColor: "currentColor"
                          }
                        }
                      ),
                        call.status === "pending" ? "Calling" : call.status
                      ]
                    })
                  }),
                /* @__PURE__ */ jsxRuntime.jsx(Td, { fontSize: "1.4rem", children: call.rating ? /* @__PURE__ */ jsxRuntime.jsx(RatingStars, { children: "\u2605".repeat(call.rating) }) : /* @__PURE__ */ jsxRuntime.jsx("span", { style: { fontSize: "1.2rem" }, children: "---" }) })
                  ]
                },
                idx
              ))
            })
            ]
          })
        }),
          meta.pagination?.pageCount > 1 && /* @__PURE__ */ jsxRuntime.jsxs(PaginationContainer, {
            children: [
          /* @__PURE__ */ jsxRuntime.jsx(
              PaginationButton,
              {
                disabled: page === 1,
                onClick: handlePrevPage,
                children: "Previous"
              }
            ),
          /* @__PURE__ */ jsxRuntime.jsxs(PaginationInfo, {
              children: [
                "Page ",
                page,
                " of ",
                meta.pagination?.pageCount || 1
              ]
            }),
          /* @__PURE__ */ jsxRuntime.jsx(
              PaginationButton,
              {
                disabled: page >= (meta?.pagination?.pageCount || 1),
                onClick: handleNextPage,
                children: "Next"
              }
            )
            ]
          })
        ]
      });
    }
    function KpiCard({ label, value, tone = "emerald", chartData, Icon, ...rest }) {
      const theme = styled.useTheme();
      const getIconColor = (tone2) => {
        switch (tone2) {
          case "emerald":
            return theme.colors.success700;
          case "sky":
            return theme.colors.primary700;
          case "rose":
            return theme.colors.danger700;
          case "amber":
            return theme.colors.warning700;
          default:
            return theme.colors.neutral700;
        }
      };
      return /* @__PURE__ */ jsxRuntime.jsx(KpiCardContainer, {
        ...rest, children: /* @__PURE__ */ jsxRuntime.jsxs(KpiTop, {
          children: [
        /* @__PURE__ */ jsxRuntime.jsxs(KpiInfo, {
            children: [
          /* @__PURE__ */ jsxRuntime.jsxs(KpiLabel, {
              children: [
                Icon && /* @__PURE__ */ jsxRuntime.jsx(Icon, { style: { width: "2rem", height: "2rem", color: getIconColor(tone) } }),
                label,
                label === "Ongoing calls" && /* @__PURE__ */ jsxRuntime.jsxs(StatusBadge, {
                  status: "ongoing", children: [
              /* @__PURE__ */ jsxRuntime.jsx(
                    "span",
                    {
                      style: {
                        width: 4,
                        height: 4,
                        borderRadius: "50%",
                        backgroundColor: "currentColor"
                      }
                    }
                  ),
              /* @__PURE__ */ jsxRuntime.jsx("span", { style: { paddingLeft: "0.4rem" }, children: "Live" })
                  ]
                })
              ]
            }),
          /* @__PURE__ */ jsxRuntime.jsx(KpiValue, { children: value })
            ]
          }),
            chartData && /* @__PURE__ */ jsxRuntime.jsx(KpiChartWrapper, { children: /* @__PURE__ */ jsxRuntime.jsx(PieChartWithPaddingAngle, { data: chartData, tone }) })
          ]
        })
      });
    }
    function PieChartWithPaddingAngle({ isAnimationActive = true, data, tone }) {
      const theme = styled.useTheme();
      const chartColors = {
        Voice: "#7476f1ff",
        Video: "#48ecbbff"
      };
      const getColors = (tone2) => {
        switch (tone2) {
          case "emerald":
            return [theme.colors.success500, theme.colors.success200];
          case "sky":
            return [theme.colors.primary500, theme.colors.primary200];
          case "rose":
            return [theme.colors.danger500, theme.colors.danger200];
          case "amber":
            return [theme.colors.warning500, theme.colors.warning200];
          default:
            return [theme.colors.neutral500, theme.colors.neutral200];
        }
      };
      const defaultColors = getColors(tone);
      return /* @__PURE__ */ jsxRuntime.jsx(recharts.ResponsiveContainer, {
        width: "100%", height: "100%", children: /* @__PURE__ */ jsxRuntime.jsxs(recharts.PieChart, {
          children: [
        /* @__PURE__ */ jsxRuntime.jsx(
            recharts.Pie,
            {
              data,
              innerRadius: "70%",
              outerRadius: "100%",
              cornerRadius: "50%",
              paddingAngle: 6,
              dataKey: "value",
              isAnimationActive,
              stroke: "none",
              children: data.map((entry, index2) => /* @__PURE__ */ jsxRuntime.jsx(
                recharts.Cell,
                {
                  fill: chartColors[entry.name] || defaultColors[index2 % defaultColors.length]
                },
                `cell-${index2}`
              ))
            }
          ),
        /* @__PURE__ */ jsxRuntime.jsx(recharts.Tooltip, { content: /* @__PURE__ */ jsxRuntime.jsx(CustomTooltip, {}), cursor: { fill: "transparent" } })
          ]
        })
      });
    }
    function CustomTooltip({ active, payload }) {
      if (active && payload && payload.length) {
        const { name, value, fill } = payload[0].payload;
        return /* @__PURE__ */ jsxRuntime.jsxs("div", {
          style: {
            backgroundColor: "#fff",
            color: "#333",
            padding: "4px 10px",
            borderRadius: "6px",
            fontSize: "11px",
            fontWeight: "600",
            boxShadow: "0 4px 10px rgba(0,0,0,0.1)",
            border: `1.5px solid ${fill}`,
            display: "flex",
            flexDirection: "row",
            gap: "8px",
            alignItems: "center",
            whiteSpace: "nowrap"
          }, children: [
          /* @__PURE__ */ jsxRuntime.jsx("span", { style: { color: "#666", fontSize: "9px", textTransform: "uppercase", letterSpacing: "0.05em" }, children: name }),
          /* @__PURE__ */ jsxRuntime.jsx("span", { style: { color: fill, fontSize: "12px" }, children: value })
          ]
        });
      }
      return null;
    }
    function KpiSection({ stats = {} }) {
      const { voice = {}, video = {}, expertsOnline = 0 } = stats;
      const totalLiveCalls = (voice.liveCalls || 0) + (video.liveCalls || 0);
      const totalCallsToday = (voice.callsToday || 0) + (video.callsToday || 0);
      const totalDeclinedCalls = (voice.declinedCalls || 0) + (video.declinedCalls || 0);
      const totalCompletedCalls = (voice.completedCalls || 0) + (video.completedCalls || 0);
      const totalAvgDuration = voice.avgDuration || video.avgDuration || 0;
      return /* @__PURE__ */ jsxRuntime.jsxs(KpiSection$1, {
        children: [
        /* @__PURE__ */ jsxRuntime.jsxs(KpiGrid, {
          children: [
          /* @__PURE__ */ jsxRuntime.jsx(
            KpiCard,
            {
              label: "Ongoing calls",
              value: totalLiveCalls,
              tone: "emerald",
              Icon: index.ActiveCall,
              style: { cursor: "pointer" },
              chartData: [
                { name: "Voice", value: voice.liveCalls || 0 },
                { name: "Video", value: video.liveCalls || 0 }
              ],
              onClick: () => totalLiveCalls > 0 && window.open(`/admin/content-manager/collection-types/api::call.call?filters[$and][0][callStatus][$eq]=ongoing&filters[$and][1][createdAt][$gte]=${encodeURIComponent((/* @__PURE__ */ new Date()).toISOString().split("T")[0] + "T00:00:00.000Z")}&page=1`, "_blank")
            }
          ),
          /* @__PURE__ */ jsxRuntime.jsx(
            KpiCard,
            {
              label: "Total calls today",
              value: totalCallsToday,
              chip: "Including free & paid",
              tone: "sky",
              Icon: index.TotalCalls
            }
          )
          ]
        }),
        /* @__PURE__ */ jsxRuntime.jsxs(KpiGrid, {
          children: [
          /* @__PURE__ */ jsxRuntime.jsx(
            KpiCard,
            {
              label: "Declined calls",
              value: totalDeclinedCalls,
              tone: "rose",
              Icon: index.DeclineCall,
              style: { cursor: totalDeclinedCalls && "pointer" },
              chartData: [
                { name: "Voice", value: voice.declinedCalls || 0 },
                { name: "Video", value: video.declinedCalls || 0 }
              ],
              onClick: () => totalDeclinedCalls > 0 && window.open(`/admin/content-manager/collection-types/api::call.call?filters[$and][0][callStatus][$eq]=declined&filters[$and][1][createdAt][$gte]=${encodeURIComponent(new Date((/* @__PURE__ */ new Date()).setUTCHours(0, 0, 0, 0)).toISOString())}&page=1`, "_blank")
            }
          ),
          /* @__PURE__ */ jsxRuntime.jsx(
            KpiCard,
            {
              label: "Completed calls",
              value: totalCompletedCalls,
              tone: "emerald",
              Icon: index.CompletedCall,
              style: { cursor: "pointer" },
              onClick: () => totalCompletedCalls > 0 && window.open(`/admin/content-manager/collection-types/api::call.call?filters[$and][0][callStatus][$eq]=completed&filters[$and][1][createdAt][$gte]=${encodeURIComponent(new Date((/* @__PURE__ */ new Date()).setUTCHours(0, 0, 0, 0)).toISOString())}&page=1`, "_blank")
            }
          )
          ]
        }),
        /* @__PURE__ */ jsxRuntime.jsxs(KpiGrid, {
          children: [
          /* @__PURE__ */ jsxRuntime.jsx(
            KpiCard,
            {
              label: "Experts online",
              value: expertsOnline,
              tone: "sky",
              Icon: index.Expert,
              onClick: () => expertsOnline > 0 && window.open(
                `/admin/content-manager/collection-types/api::expert-profile.expert-profile?filters[$and][0][isActive][$eq]=true&sort=createdAt:DESC&page=1&pageSize=100`,
                "_blank"
              )
            }
          ),
          /* @__PURE__ */ jsxRuntime.jsx(
            KpiCard,
            {
              label: "Total call duration",
              value: minutesToMMSS(totalAvgDuration),
              tone: "emerald",
              Icon: index.CallTime
            }
          )
          ]
        })
        ]
      });
    }
    function CallsLiveDashboard() {
      const { stats = {}, liveCalls } = useStreamData() || {};
      const [timeFilter, setTimeFilter] = react.useState("60min");
      const [customRange, setCustomRange] = react.useState({ start: "", end: "" });
      const handleFilterChange = (filter, custom) => {
        setTimeFilter(filter);
        if (custom)
          setCustomRange(custom);
      };
      return /* @__PURE__ */ jsxRuntime.jsxs(DashboardContainer, {
        children: [
        /* @__PURE__ */ jsxRuntime.jsx(Header, { stats, filter: timeFilter, onFilterChange: handleFilterChange }),
        /* @__PURE__ */ jsxRuntime.jsx(Main, {
          children: /* @__PURE__ */ jsxRuntime.jsxs(GridContainer, {
            children: [
          /* @__PURE__ */ jsxRuntime.jsxs(Column, {
              children: [
            /* @__PURE__ */ jsxRuntime.jsx(KpiSection, { stats }),
            /* @__PURE__ */ jsxRuntime.jsx(
                CategoryGrid,
                {
                  liveCalls: liveCalls?.length,
                  filter: timeFilter,
                  customRange
                }
              )
              ]
            }),
          /* @__PURE__ */ jsxRuntime.jsxs(Column, {
              children: [
            /* @__PURE__ */ jsxRuntime.jsx(LiveCallsTable, { stats, liveCalls }),
            /* @__PURE__ */ jsxRuntime.jsx(
                RecentCallsTable,
                {
                  liveCalls: liveCalls?.length,
                  filter: timeFilter,
                  customRange
                }
              )
              ]
            })
            ]
          })
        })
        ]
      });
    }
    var queryClient = new reactQuery.QueryClient();
    var HomePage = () => {
      const { formatMessage } = reactIntl.useIntl();
      return /* @__PURE__ */ jsxRuntime.jsx(designSystem.Main, { children: /* @__PURE__ */ jsxRuntime.jsx(reactQuery.QueryClientProvider, { client: queryClient, children: /* @__PURE__ */ jsxRuntime.jsx(CallsLiveDashboard, {}) }) });
    };
    var App = () => {
      return /* @__PURE__ */ jsxRuntime.jsxs(reactRouterDom.Routes, {
        children: [
        /* @__PURE__ */ jsxRuntime.jsx(reactRouterDom.Route, { index: true, element: /* @__PURE__ */ jsxRuntime.jsx(HomePage, {}) }),
        /* @__PURE__ */ jsxRuntime.jsx(reactRouterDom.Route, { path: "*", element: /* @__PURE__ */ jsxRuntime.jsx(admin2.Page.Error, {}) })
        ]
      });
    };
    exports2.App = App;
  }
});

// dist/_chunks/en-B4KWt_jN.js
var require_en_B4KWt_jN = __commonJS({
  "dist/_chunks/en-B4KWt_jN.js"(exports2) {
    "use strict";
    Object.defineProperty(exports2, Symbol.toStringTag, { value: "Module" });
    var en = {};
    exports2.default = en;
  }
});

// dist/_chunks/index-D37jjv0-.js
var require_index_D37jjv0 = __commonJS({
  "dist/_chunks/index-D37jjv0-.js"(exports2) {
    "use strict";
    var react = require("react");
    var jsxRuntime = require("react/jsx-runtime");
    var __variableDynamicImportRuntimeHelper = (glob, path, segs) => {
      const v = glob[path];
      if (v) {
        return typeof v === "function" ? v() : Promise.resolve(v);
      }
      return new Promise((_, reject) => {
        (typeof queueMicrotask === "function" ? queueMicrotask : setTimeout)(
          reject.bind(
            null,
            new Error(
              "Unknown variable dynamic import: " + path + (path.split("/").length !== segs ? ". Note that variables only represent file names one level deep." : "")
            )
          )
        );
      });
    };
    var PLUGIN_ID = "admin-pannel";
    var Initializer = ({ setPlugin }) => {
      const ref = react.useRef(setPlugin);
      react.useEffect(() => {
        ref.current(PLUGIN_ID);
      }, []);
      return null;
    };
    var VoiceCall = ({ style }) => /* @__PURE__ */ jsxRuntime.jsx("svg", { style, viewBox: "0 0 24 24", fill: "none", xmlns: "http://www.w3.org/2000/svg", children: /* @__PURE__ */ jsxRuntime.jsx("path", { d: "M14.5562 15.5477L14.1007 16.0272C14.1007 16.0272 13.0181 17.167 10.0631 14.0559C7.10812 10.9448 8.1907 9.80507 8.1907 9.80507L8.47752 9.50311C9.18407 8.75924 9.25068 7.56497 8.63424 6.6931L7.37326 4.90961C6.61028 3.8305 5.13596 3.68795 4.26145 4.60864L2.69185 6.26114C2.25823 6.71766 1.96765 7.30945 2.00289 7.96594C2.09304 9.64546 2.81071 13.259 6.81536 17.4752C11.0621 21.9462 15.0468 22.1239 16.6763 21.9631C17.1917 21.9122 17.6399 21.6343 18.0011 21.254L19.4217 19.7584C20.3806 18.7489 20.1102 17.0182 18.8833 16.312L16.9728 15.2123C16.1672 14.7486 15.1858 14.8848 14.5562 15.5477Z", fill: "currentColor" }) });
    var ActiveCall = ({ style }) => /* @__PURE__ */ jsxRuntime.jsxs("svg", {
      style, viewBox: "0 0 81 77", fill: "none", xmlns: "http://www.w3.org/2000/svg", children: [
      /* @__PURE__ */ jsxRuntime.jsx("path", { d: "M72.2202 49.455L64.7377 41.9725C62.7664 40.0154 60.1013 38.9171 57.3235 38.9171C54.5457 38.9171 51.8806 40.0154 49.9093 41.9725L44.8868 46.9266C44.2032 47.5986 43.2829 47.975 42.3243 47.975C41.3658 47.975 40.4455 47.5986 39.7618 46.9266C25.856 33.0208 26.0952 35.6517 34.7393 26.8025C36.7047 24.8356 37.8088 22.1689 37.8088 19.3883C37.8088 16.6078 36.7047 13.941 34.7393 11.9742L27.2568 4.49165C25.29 2.52626 22.6232 1.42224 19.8427 1.42224C17.0622 1.42224 14.3954 2.52626 12.4285 4.49165L4.94601 11.9742C-13.1623 30.0825 22.0977 76.5833 51.8227 76.5833C61.6627 76.5833 64.4985 71.9708 72.3227 64.2833C74.2745 62.3029 75.3602 59.6285 75.3409 56.8479C75.3217 54.0674 74.1992 51.4082 72.2202 49.455ZM67.4027 59.5L59.9202 66.9142C53.0868 73.7475 36.0035 68.0075 22.3368 54.4433C8.67018 40.8792 3.03268 23.6933 9.86601 16.86L17.2118 9.30915C17.897 8.6269 18.8245 8.24385 19.7914 8.24385C20.7583 8.24385 21.6859 8.6269 22.371 9.30915C33.441 20.3792 33.441 18.3633 24.8652 26.9733C23.8931 27.9443 23.1219 29.0974 22.5957 30.3666C22.0695 31.6359 21.7987 32.9964 21.7987 34.3704C21.7987 35.7444 22.0695 37.1049 22.5957 38.3742C23.1219 39.6434 23.8931 40.7965 24.8652 41.7675L34.876 51.7783C36.865 53.6749 39.5078 54.7329 42.256 54.7329C45.0043 54.7329 47.647 53.6749 49.636 51.7783L54.7952 46.79C55.4927 46.1317 56.4156 45.7649 57.3748 45.7649C58.3339 45.7649 59.2568 46.1317 59.9543 46.79L67.4368 54.2725C67.7786 54.6175 68.0489 55.0267 68.2322 55.4764C68.4155 55.9262 68.5083 56.4077 68.5051 56.8933C68.5019 57.379 68.4029 57.8592 68.2137 58.3066C68.0246 58.7539 67.7489 59.1594 67.4027 59.5Z", fill: "currentColor", fillOpacity: "0.8" }),
      /* @__PURE__ */ jsxRuntime.jsx("path", { d: "M65.1058 33C64.4728 32.9993 63.8617 32.7706 63.3872 32.357C62.9126 31.9433 62.6071 31.3729 62.528 30.7528C62.0254 26.7936 60.2002 23.1129 57.341 20.2928C54.4818 17.4727 50.7519 15.6743 46.7413 15.182C46.4024 15.1402 46.0752 15.0329 45.7784 14.8662C45.4815 14.6996 45.2208 14.4768 45.0112 14.2107C44.8015 13.9445 44.647 13.6402 44.5564 13.3151C44.4659 12.99 44.4411 12.6505 44.4835 12.316C44.5258 11.9814 44.6345 11.6583 44.8033 11.3653C44.9721 11.0722 45.1978 10.8148 45.4673 10.6078C45.7369 10.4008 46.0451 10.2482 46.3744 10.1588C46.7037 10.0694 47.0475 10.045 47.3864 10.0868C52.5446 10.7193 57.3419 13.0318 61.0195 16.6585C64.697 20.2851 67.0448 25.0188 67.6914 30.1108C67.7376 30.4727 67.7052 30.8401 67.5963 31.1887C67.4874 31.5373 67.3046 31.8589 67.0599 32.1323C66.8153 32.4056 66.5145 32.6244 66.1776 32.774C65.8406 32.9236 65.4753 33.0006 65.1058 33Z", fill: "currentColor" }),
      /* @__PURE__ */ jsxRuntime.jsx("path", { d: "M12.161 31.5276C12.532 32.4523 13.3822 33.0478 14.3161 33.1459C14.7595 33.1902 15.2067 33.1216 15.6149 32.9465C16.0232 32.7715 16.3789 32.4958 16.6481 32.146C16.9173 31.7961 17.091 31.3837 17.1527 30.9481C17.2143 30.5125 17.1617 30.0683 17.0001 29.6579C15.7954 26.6365 15.9385 25.3991 15.9282 25.398C16.0345 25.058 16.454 24.1027 18.0343 22.5309C18.5196 22.0481 18.7903 21.3941 18.7869 20.7128C18.7834 20.0316 18.5061 19.3788 18.0159 18.8982C17.5257 18.4176 16.8627 18.1485 16.1729 18.1501C15.4831 18.1517 14.8229 18.4239 14.3376 18.9067C12.5791 20.6561 11.4437 22.3263 10.9573 23.8684C10.5866 25.0561 10.4946 27.3498 12.161 31.5276Z", fill: "currentColor" }),
      /* @__PURE__ */ jsxRuntime.jsx("path", { d: "M78.7067 30C78.2 29.9992 77.7124 29.8065 77.342 29.4606C76.9716 29.1148 76.746 28.6414 76.7106 28.1359C75.8047 15.2875 65.4331 4.91054 52.5844 4.00454C52.321 3.9872 52.0636 3.91797 51.827 3.80084C51.5903 3.68371 51.3792 3.52098 51.2057 3.32199C51.0321 3.12301 50.8996 2.89169 50.8157 2.64133C50.7318 2.39097 50.6982 2.1265 50.7168 1.86312C50.7355 1.59973 50.8059 1.34262 50.9242 1.10655C51.0424 0.870477 51.2062 0.660102 51.406 0.487507C51.6058 0.314911 51.8377 0.183497 52.0884 0.100813C52.3392 0.018129 52.6037 -0.0141956 52.867 0.00569625C67.6958 1.05201 79.6627 13.0265 80.7069 27.8553C80.7443 28.3855 80.5696 28.909 80.2212 29.3104C79.8728 29.7119 79.3792 29.9585 78.849 29.996L78.7067 30Z", fill: "currentColor" })
      ]
    });
    var DeclineCall = ({ style }) => /* @__PURE__ */ jsxRuntime.jsxs("svg", {
      style, viewBox: "0 0 76 76", fill: "none", xmlns: "http://www.w3.org/2000/svg", children: [
      /* @__PURE__ */ jsxRuntime.jsx("path", { d: "M72.2202 48.0327L64.7377 40.5502C62.7664 38.5932 60.1013 37.4949 57.3235 37.4949C54.5457 37.4949 51.8806 38.5932 49.9093 40.5502L44.8868 45.5044C44.2032 46.1763 43.2829 46.5528 42.3243 46.5528C41.3658 46.5528 40.4455 46.1763 39.7618 45.5044C25.856 31.5986 26.0952 34.2294 34.7393 25.3802C36.7047 23.4134 37.8088 20.7466 37.8088 17.9661C37.8088 15.1855 36.7047 12.5188 34.7393 10.5519L27.2568 3.06941C25.29 1.10402 22.6232 0 19.8427 0C17.0622 0 14.3954 1.10402 12.4285 3.06941L4.94601 10.5519C-13.1623 28.6602 22.0977 75.1611 51.8227 75.1611C61.6627 75.1611 64.4985 70.5486 72.3227 62.8611C74.2745 60.8806 75.3602 58.2062 75.341 55.4257C75.3217 52.6451 74.1992 49.986 72.2202 48.0327ZM67.4027 58.0777L59.9202 65.4919C53.0868 72.3252 36.0035 66.5852 22.3368 53.0211C8.67018 39.4569 3.03268 22.2711 9.86601 15.4377L17.2118 7.88691C17.897 7.20466 18.8245 6.82161 19.7914 6.82161C20.7583 6.82161 21.6859 7.20466 22.371 7.88691C33.441 18.9569 33.441 16.9411 24.8652 25.5511C23.8931 26.5221 23.1219 27.6752 22.5957 28.9444C22.0695 30.2137 21.7987 31.5742 21.7987 32.9482C21.7987 34.3222 22.0695 35.6827 22.5957 36.9519C23.1219 38.2212 23.8931 39.3743 24.8652 40.3452L34.876 50.3561C36.865 52.2526 39.5078 53.3107 42.256 53.3107C45.0043 53.3107 47.647 52.2526 49.636 50.3561L54.7952 45.3677C55.4927 44.7094 56.4156 44.3427 57.3748 44.3427C58.3339 44.3427 59.2568 44.7094 59.9543 45.3677L67.4369 52.8502C67.7786 53.1953 68.0489 53.6044 68.2322 54.0542C68.4156 54.5039 68.5083 54.9854 68.5051 55.4711C68.5019 55.9567 68.4029 56.437 68.2137 56.8843C68.0246 57.3316 67.7489 57.7372 67.4027 58.0777Z", fill: "currentColor", fillOpacity: "0.8" }),
      /* @__PURE__ */ jsxRuntime.jsx("path", { d: "M12.161 30.1053C12.532 31.03 13.3822 31.6255 14.3161 31.7237C14.7595 31.768 15.2067 31.6993 15.6149 31.5243C16.0232 31.3492 16.3789 31.0736 16.6481 30.7237C16.9173 30.3739 17.091 29.9614 17.1527 29.5258C17.2143 29.0903 17.1617 28.646 17.0001 28.2356C15.7954 25.2142 15.9385 23.9768 15.9282 23.9758C16.0345 23.6357 16.454 22.6805 18.0343 21.1087C18.5196 20.6258 18.7903 19.9718 18.7869 19.2906C18.7834 18.6093 18.5061 17.9566 18.0159 17.476C17.5257 16.9954 16.8627 16.7263 16.1729 16.7279C15.4831 16.7295 14.8229 17.0016 14.3376 17.4845C12.5791 19.2338 11.4437 20.904 10.9573 22.4462C10.5866 23.6338 10.4946 25.9276 12.161 30.1053Z", fill: "currentColor", fillOpacity: "0.8" }),
      /* @__PURE__ */ jsxRuntime.jsx("circle", { cx: "61.5", cy: "16.5", r: "11.5", stroke: "currentColor", strokeWidth: "4" }),
      /* @__PURE__ */ jsxRuntime.jsx("path", { d: "M53.5 10.5L70.5 22", stroke: "currentColor", strokeWidth: "4" })
      ]
    });
    var CompletedCall = ({ style }) => /* @__PURE__ */ jsxRuntime.jsxs("svg", {
      style, viewBox: "0 0 77 76", fill: "none", xmlns: "http://www.w3.org/2000/svg", children: [
      /* @__PURE__ */ jsxRuntime.jsx("path", { d: "M72.2202 48.0327L64.7377 40.5502C62.7664 38.5932 60.1013 37.4949 57.3235 37.4949C54.5457 37.4949 51.8806 38.5932 49.9093 40.5502L44.8868 45.5044C44.2032 46.1763 43.2829 46.5528 42.3243 46.5528C41.3658 46.5528 40.4455 46.1763 39.7618 45.5044C25.856 31.5986 26.0952 34.2294 34.7393 25.3802C36.7047 23.4134 37.8088 20.7466 37.8088 17.9661C37.8088 15.1855 36.7047 12.5188 34.7393 10.5519L27.2568 3.06941C25.29 1.10402 22.6232 0 19.8427 0C17.0622 0 14.3954 1.10402 12.4285 3.06941L4.94601 10.5519C-13.1623 28.6602 22.0977 75.1611 51.8227 75.1611C61.6627 75.1611 64.4985 70.5486 72.3227 62.8611C74.2745 60.8807 75.3602 58.2062 75.3409 55.4257C75.3217 52.6451 74.1992 49.986 72.2202 48.0327ZM67.4027 58.0777L59.9202 65.4919C53.0868 72.3252 36.0035 66.5852 22.3368 53.0211C8.67018 39.4569 3.03268 22.2711 9.86601 15.4377L17.2118 7.88691C17.897 7.20466 18.8245 6.82161 19.7914 6.82161C20.7583 6.82161 21.6859 7.20466 22.371 7.88691C33.441 18.9569 33.441 16.9411 24.8652 25.5511C23.8931 26.5221 23.1219 27.6752 22.5957 28.9444C22.0695 30.2137 21.7987 31.5742 21.7987 32.9482C21.7987 34.3222 22.0695 35.6827 22.5957 36.9519C23.1219 38.2212 23.8931 39.3743 24.8652 40.3452L34.876 50.3561C36.865 52.2526 39.5078 53.3107 42.256 53.3107C45.0043 53.3107 47.647 52.2526 49.636 50.3561L54.7952 45.3677C55.4927 44.7094 56.4156 44.3427 57.3748 44.3427C58.3339 44.3427 59.2568 44.7094 59.9543 45.3677L67.4368 52.8502C67.7786 53.1953 68.0489 53.6044 68.2322 54.0542C68.4155 54.5039 68.5083 54.9854 68.5051 55.4711C68.5019 55.9567 68.4029 56.437 68.2137 56.8843C68.0246 57.3316 67.7489 57.7372 67.4027 58.0777Z", fill: "currentColor", fillOpacity: "0.8" }),
      /* @__PURE__ */ jsxRuntime.jsx("path", { d: "M12.161 30.1053C12.532 31.03 13.3822 31.6255 14.3161 31.7237C14.7595 31.768 15.2067 31.6993 15.6149 31.5243C16.0232 31.3492 16.3789 31.0736 16.6481 30.7237C16.9173 30.3739 17.091 29.9614 17.1527 29.5258C17.2143 29.0903 17.1617 28.646 17.0001 28.2356C15.7954 25.2142 15.9385 23.9768 15.9282 23.9758C16.0345 23.6357 16.454 22.6805 18.0343 21.1087C18.5196 20.6258 18.7903 19.9718 18.7869 19.2906C18.7834 18.6093 18.5061 17.9566 18.0159 17.476C17.5257 16.9954 16.8627 16.7263 16.1729 16.7279C15.4831 16.7295 14.8229 17.0016 14.3376 17.4845C12.5791 19.2338 11.4437 20.904 10.9573 22.4462C10.5866 23.6338 10.4946 25.9276 12.161 30.1053Z", fill: "currentColor", fillOpacity: "0.8" }),
      /* @__PURE__ */ jsxRuntime.jsx("path", { d: "M49.3424 17.9439L53.106 28.1892L64.0429 22.7204L74.9799 17.2516", stroke: "currentColor", strokeWidth: "4", strokeLinecap: "round", strokeLinejoin: "round" })
      ]
    });
    var VideoCall = ({ style }) => /* @__PURE__ */ jsxRuntime.jsxs("svg", {
      style, viewBox: "0 0 48 48", version: "1", xmlns: "http://www.w3.org/2000/svg", "enable-background": "new 0 0 48 48", children: [
      /* @__PURE__ */ jsxRuntime.jsx("path", { fill: "currentColor", d: "M8,12h22c2.2,0,4,1.8,4,4v16c0,2.2-1.8,4-4,4H8c-2.2,0-4-1.8-4-4V16C4,13.8,5.8,12,8,12z" }),
      /* @__PURE__ */ jsxRuntime.jsx("polygon", { fill: "currentColor", points: "44,35 34,29 34,19 44,13" })
      ]
    });
    var Expert = ({ style }) => /* @__PURE__ */ jsxRuntime.jsxs("svg", {
      fill: "currentColor", style, version: "1.1", id: "Capa_1", xmlns: "http://www.w3.org/2000/svg", "xmlns:xlink": "http://www.w3.org/1999/xlink", viewBox: "0 0 202.704 202.704", "xml:space": "preserve", stroke: "currentColor", "stroke-width": "3.243264", children: [
      /* @__PURE__ */ jsxRuntime.jsx("g", { id: "SVGRepo_bgCarrier", "stroke-width": "0" }),
      /* @__PURE__ */ jsxRuntime.jsx("g", { id: "SVGRepo_tracerCarrier", "stroke-linecap": "round", "stroke-linejoin": "round" }),
      /* @__PURE__ */ jsxRuntime.jsxs("g", {
        id: "SVGRepo_iconCarrier", children: [
          " ",
        /* @__PURE__ */ jsxRuntime.jsx("path", { d: "M192.487,202.704H10.217c-1.657,0-3-1.343-3-3v-34.815c0-13.469,8.08-25.404,20.585-30.406l43.126-17.25 c0.755-0.302,1.601-0.285,2.342,0.048c0.742,0.333,1.317,0.952,1.594,1.717l12.694,35.096l4.177-12.008l-3.692-9.024 c-0.379-0.925-0.271-1.979,0.285-2.808c0.558-0.83,1.491-1.328,2.491-1.328h21.066c1,0,1.934,0.498,2.491,1.328 c0.557,0.83,0.664,1.883,0.285,2.808l-3.691,9.025l4.177,12.008l12.694-35.096c0.276-0.765,0.852-1.384,1.594-1.717 c0.741-0.333,1.587-0.35,2.342-0.048l43.125,17.25c12.506,5.002,20.586,16.938,20.586,30.406v34.815 C195.487,201.361,194.145,202.704,192.487,202.704z M13.217,196.704h176.271v-31.815c0-11.001-6.6-20.75-16.814-24.835 l-40.245-16.098l-14.516,40.131c-0.432,1.194-1.57,1.971-2.84,1.979c-1.271-0.008-2.397-0.815-2.815-2.015l-7.326-21.066 c-0.24-0.69-0.221-1.445,0.057-2.121l2.429-5.939H95.287l2.43,5.938c0.277,0.677,0.297,1.431,0.058,2.122l-7.327,21.066 c-0.418,1.2-1.545,2.007-2.815,2.015c-1.307-0.004-2.408-0.785-2.84-1.979l-14.516-40.131L30.03,140.054 c-10.214,4.085-16.813,13.833-16.813,24.835V196.704z M169.459,189.581h-33.577c-1.657,0-3-1.343-3-3v-20.67c0-1.657,1.343-3,3-3 h33.577c1.657,0,3,1.343,3,3v20.67C172.459,188.237,171.116,189.581,169.459,189.581z M138.882,183.581h27.577v-14.67h-27.577 V183.581z M101.352,116.527c-4.644,0-9.172-0.862-13.459-2.563c-3.313-1.315-6.051-2.969-8.136-4.916 c-5.759-5.375-11.746-16.877-13.953-21.355c-3.748-0.182-11.435-2.18-14.763-14.903c-1.652-6.318-1.275-11.396,1.12-15.092 c1.307-2.018,2.952-3.206,4.313-3.896c-0.024-1.576,0.012-3.873,0.264-6.625c-2.109-3.221-6.722-12.826,1.198-26.884 c0.002-0.003,0.003-0.005,0.005-0.008c0,0,0.009-0.016,0.011-0.02c0,0,0,0,0.001,0c0.001-0.002,0.04-0.071,0.043-0.077c0,0,0,0,0,0 c0.007-0.011,0.014-0.023,0.02-0.034c0.008-0.013,0.015-0.026,0.022-0.039c0.002-0.003,0.004-0.006,0.006-0.009 c5.184-9.066,11.891-10.976,16.613-10.979c0.001,0,0.002,0,0.003,0l0,0c0.001,0,0.001,0,0.001,0h0.001c0.002,0,0.005,0,0.005,0 s0,0,0.001,0l0,0l0,0h0.001c1.158,0,2.202,0.118,3.087,0.279C79.908,5.624,85.944,0,102.786,0c0.001,0-0.001,0,0.001,0l0,0l0,0 h0.001c0.01,0,0.02,0,0.03,0l0.762,0.004c0.007,0,0.014,0,0.021,0h0.005c0.01,0,0.019,0,0.027,0 c11.117,0.123,19.981,4.198,25.502,7.636c10.488,5.131,16.901,15.851,18.474,21.415c0.688,2.437,1.033,5.27,1.023,8.419 c0,0.001,0,0.002,0,0.003l0,0l0,0c0,0,0,0.001,0,0.002c0,0.003,0,0.007,0,0.011c0,0,0,0,0,0v0c0,0.001,0,0.003,0,0.004 c0,0.002,0,0.005,0,0.008l0,0l0,0c0,0,0,0,0,0.001c0,0.004,0,0.009,0,0.014c0,0,0,0,0,0l0,0c0,0.004,0,0.009,0,0.013 c0,0.005,0,0.011,0,0.016c-0.034,7.208-1.879,14.121-2.399,15.929c-0.001,0.111-0.002,0.219-0.004,0.323 c1.361,0.69,3.007,1.878,4.313,3.896c2.396,3.697,2.772,8.774,1.12,15.092c-3.327,12.723-11.014,14.722-14.762,14.904 c-2.207,4.478-8.194,15.98-13.954,21.356c-2.086,1.947-4.823,3.601-8.136,4.915C110.523,115.665,105.995,116.527,101.352,116.527z M67.607,81.621c1.159,0,2.265,0.657,2.763,1.726c0.071,0.154,7.25,15.499,13.481,21.315c1.536,1.434,3.64,2.687,6.254,3.725 c3.58,1.42,7.363,2.141,11.246,2.141s7.666-0.72,11.246-2.141c2.613-1.037,4.718-2.29,6.255-3.724 c6.231-5.817,13.41-21.161,13.481-21.315c0.586-1.258,1.962-1.949,3.318-1.675c-0.001,0-0.001,0-0.001,0 c0.008,0,0.253,0.036,0.636,0.036c2.555,0,7.195-1.356,9.57-10.437c1.173-4.485,1.072-8.018-0.29-10.216 c-1.15-1.855-2.898-2.237-2.973-2.252c-1.542-0.257-2.573-1.645-2.441-3.203c0-0.006,0.075-0.93,0.082-2.467 c-0.054-0.839-0.476-3.372-1.746-4.578c-1.536-1.227-10.882-3.03-19.92-4.774c-3.799-0.733-8.104-1.563-12.642-2.492 c-0.005-0.001-0.011-0.002-0.017-0.003c-2.966-0.539-5.524-1.269-7.609-2.168c-7.623-2.815-12.868-6.852-16.056-9.932 c-1.148,3.183-2.991,7.132-5.756,10.118c-4.905,5.298-10.839,8.103-13.849,9.278c-0.32,4.171-0.095,6.988-0.092,7.02 c0.13,1.556-0.956,2.956-2.496,3.212c-0.02,0.006-1.768,0.388-2.918,2.243c-1.362,2.198-1.463,5.731-0.29,10.216 c2.376,9.082,7.017,10.437,9.571,10.437c0.42,0,0.675-0.043,0.677-0.043C67.265,81.635,67.437,81.621,67.607,81.621z M80.888,20.096 c0.995,0,1.942,0.496,2.504,1.348c0.045,0.067,5.311,7.753,17.061,12.071c0.057,0.021,0.111,0.042,0.166,0.066 c1.687,0.736,3.847,1.345,6.419,1.81c0.038,0.007,0.075,0.014,0.113,0.022c4.485,0.918,8.772,1.746,12.556,2.476 c13.641,2.632,19.751,3.875,22.437,5.91c0.278-1.97,0.479-4.125,0.489-6.279h0.001h-0.001l0,0h0.001h-0.001c0-0.004,0-0.009,0-0.014 l0,0v0l0,0l0,0l0,0v0l0,0l0,0l0,0c0-0.003,0-0.007,0-0.01l0,0c0,0,0,0,0,0l0,0c0,0,0,0,0-0.001l0,0l0,0l0,0v0l0,0 c0-0.003,0-0.006,0-0.009c0,0,0-0.001,0-0.002l0,0l0,0l0,0c0,0,0,0,0-0.001l0,0l0,0l0,0l0,0l0,0c0-0.002,0-0.004,0-0.006l0,0l0,0 l0,0l0,0l0,0l0,0l0,0c0-0.001,0-0.002,0-0.004l0,0c0,0,0,0,0,0v0l0,0l0,0l0,0l0,0v0l0,0c0,0,0-0.001,0-0.002c0-0.003,0-0.006,0-0.01 l0,0c0-0.003,0-0.006,0-0.009c0.007-2.415-0.227-4.557-0.692-6.374c-0.034-0.131-0.068-0.26-0.104-0.387 c-0.073-0.259-0.16-0.53-0.259-0.812c-1.727-4.904-7.352-13.069-15.128-16.87c-0.123-0.056-0.242-0.12-0.357-0.192 c-4.855-3.046-12.706-6.701-22.524-6.809c-0.008,0-0.017,0-0.024,0L102.787,6l0,0l0,0c-0.479,0-0.946,0.005-1.402,0.014v0 c-0.006,0-0.01,0-0.016,0c-16.85,0.358-18.756,7.092-18.845,7.457c-0.013,0.076-0.027,0.152-0.045,0.228 c-0.104,0.443-0.303,0.844-0.572,1.183c-0.206,0.259-0.45,0.478-0.722,0.653c-0.431,0.278-0.934,0.448-1.467,0.476 c-0.319,0.018-0.638-0.016-0.954-0.103c-0.147-0.041-0.29-0.091-0.427-0.152c-0.209-0.083-1.667-0.63-3.67-0.63l0,0h-0.001l0,0 c-0.002,0-0.002,0-0.004,0c-4.574,0.002-8.426,2.702-11.449,8.025c-0.002,0.003-0.004,0.006-0.006,0.009 c0,0.001-0.001,0.001-0.001,0.002c-0.004,0.007-0.008,0.013-0.012,0.02c-0.006,0.011-0.012,0.021-0.018,0.032 c-0.002,0.004-0.004,0.007-0.006,0.011c-0.002,0.002-0.003,0.004-0.004,0.006l0,0c-5.517,9.788-3.567,16.533-2.078,19.501 c2.61-1.093,7.227-3.432,10.998-7.505c3.505-3.785,5.415-10.455,5.855-12.706c0.234-1.196,1.168-2.131,2.363-2.367 C80.5,20.114,80.695,20.096,80.888,20.096z" }),
          " "
        ]
      })
      ]
    });
    var CallTime = ({ style }) => /* @__PURE__ */ jsxRuntime.jsxs("svg", {
      style, viewBox: "0 0 83 79", fill: "none", xmlns: "http://www.w3.org/2000/svg", children: [
      /* @__PURE__ */ jsxRuntime.jsx("path", { d: "M72.2202 51.455L64.7377 43.9725C62.7664 42.0154 60.1013 40.9171 57.3235 40.9171C54.5457 40.9171 51.8806 42.0154 49.9093 43.9725L44.8868 48.9266C44.2032 49.5986 43.2829 49.975 42.3243 49.975C41.3658 49.975 40.4455 49.5986 39.7618 48.9266C25.856 35.0208 26.0952 37.6517 34.7393 28.8025C36.7047 26.8356 37.8088 24.1689 37.8088 21.3883C37.8088 18.6078 36.7047 15.941 34.7393 13.9742L27.2568 6.49165C25.29 4.52626 22.6232 3.42224 19.8427 3.42224C17.0622 3.42224 14.3954 4.52626 12.4285 6.49165L4.94601 13.9742C-13.1623 32.0825 22.0977 78.5833 51.8227 78.5833C61.6627 78.5833 64.4985 73.9708 72.3227 66.2833C74.2745 64.3029 75.3602 61.6285 75.3409 58.8479C75.3217 56.0674 74.1992 53.4082 72.2202 51.455ZM67.4027 61.5L59.9202 68.9142C53.0868 75.7475 36.0035 70.0075 22.3368 56.4433C8.67018 42.8792 3.03268 25.6933 9.86601 18.86L17.2118 11.3092C17.897 10.6269 18.8245 10.2439 19.7914 10.2439C20.7583 10.2439 21.6859 10.6269 22.371 11.3092C33.441 22.3792 33.441 20.3633 24.8652 28.9733C23.8931 29.9443 23.1219 31.0974 22.5957 32.3666C22.0695 33.6359 21.7987 34.9964 21.7987 36.3704C21.7987 37.7444 22.0695 39.1049 22.5957 40.3742C23.1219 41.6434 23.8931 42.7965 24.8652 43.7675L34.876 53.7783C36.865 55.6749 39.5078 56.7329 42.256 56.7329C45.0043 56.7329 47.647 55.6749 49.636 53.7783L54.7952 48.79C55.4927 48.1317 56.4156 47.7649 57.3748 47.7649C58.3339 47.7649 59.2568 48.1317 59.9543 48.79L67.4368 56.2725C67.7786 56.6175 68.0489 57.0267 68.2322 57.4764C68.4155 57.9262 68.5083 58.4077 68.5051 58.8933C68.5019 59.379 68.4029 59.8592 68.2137 60.3066C68.0246 60.7539 67.7489 61.1594 67.4027 61.5Z", fill: "currentColor" }),
      /* @__PURE__ */ jsxRuntime.jsx("path", { d: "M12.161 33.5276C12.532 34.4523 13.3822 35.0478 14.3161 35.1459C14.7595 35.1902 15.2066 35.1216 15.6149 34.9465C16.0232 34.7715 16.3789 34.4958 16.6481 34.146C16.9173 33.7961 17.091 33.3837 17.1526 32.9481C17.2143 32.5125 17.1617 32.0683 17.0001 31.6579C15.7954 28.6365 15.9385 27.3991 15.9282 27.398C16.0345 27.058 16.454 26.1027 18.0342 24.5309C18.5196 24.0481 18.7903 23.3941 18.7869 22.7128C18.7834 22.0316 18.5061 21.3788 18.0159 20.8982C17.5257 20.4176 16.8627 20.1485 16.1729 20.1501C15.4831 20.1517 14.8229 20.4239 14.3375 20.9067C12.5791 22.6561 11.4437 24.3263 10.9573 25.8684C10.5866 27.0561 10.4946 29.3498 12.161 33.5276Z", fill: "currentColor" }),
      /* @__PURE__ */ jsxRuntime.jsx("path", { d: "M65.5 10.2083V17.5L69.1458 15.3125M78.625 17.5C78.625 24.7488 72.7488 30.625 65.5 30.625C58.2513 30.625 52.375 24.7488 52.375 17.5C52.375 10.2513 58.2513 4.375 65.5 4.375C72.7488 4.375 78.625 10.2513 78.625 17.5Z", stroke: "currentColor", "stroke-width": "3", "stroke-linecap": "round", "stroke-linejoin": "round" })
      ]
    });
    var TotalCalls = ({ style }) => /* @__PURE__ */ jsxRuntime.jsxs("svg", {
      style, viewBox: "0 0 85 76", fill: "none", xmlns: "http://www.w3.org/2000/svg", children: [
      /* @__PURE__ */ jsxRuntime.jsx("path", { d: "M72.2202 48.0327L64.7377 40.5502C62.7664 38.5932 60.1013 37.4949 57.3235 37.4949C54.5457 37.4949 51.8806 38.5932 49.9093 40.5502L44.8868 45.5044C44.2032 46.1763 43.2829 46.5528 42.3243 46.5528C41.3658 46.5528 40.4455 46.1763 39.7618 45.5044C25.856 31.5986 26.0952 34.2294 34.7393 25.3802C36.7047 23.4134 37.8088 20.7466 37.8088 17.9661C37.8088 15.1855 36.7047 12.5188 34.7393 10.5519L27.2568 3.06941C25.29 1.10402 22.6232 0 19.8427 0C17.0622 0 14.3954 1.10402 12.4285 3.06941L4.94601 10.5519C-13.1623 28.6602 22.0977 75.1611 51.8227 75.1611C61.6627 75.1611 64.4985 70.5486 72.3227 62.8611C74.2745 60.8807 75.3602 58.2062 75.3409 55.4257C75.3217 52.6451 74.1992 49.986 72.2202 48.0327ZM67.4027 58.0777L59.9202 65.4919C53.0868 72.3252 36.0035 66.5852 22.3368 53.0211C8.67018 39.4569 3.03268 22.2711 9.86601 15.4377L17.2118 7.88691C17.897 7.20466 18.8245 6.82161 19.7914 6.82161C20.7583 6.82161 21.6859 7.20466 22.371 7.88691C33.441 18.9569 33.441 16.9411 24.8652 25.5511C23.8931 26.5221 23.1219 27.6752 22.5957 28.9444C22.0695 30.2137 21.7987 31.5742 21.7987 32.9482C21.7987 34.3222 22.0695 35.6827 22.5957 36.9519C23.1219 38.2212 23.8931 39.3743 24.8652 40.3452L34.876 50.3561C36.865 52.2526 39.5078 53.3107 42.256 53.3107C45.0043 53.3107 47.647 52.2526 49.636 50.3561L54.7952 45.3677C55.4927 44.7094 56.4156 44.3427 57.3748 44.3427C58.3339 44.3427 59.2568 44.7094 59.9543 45.3677L67.4368 52.8502C67.7786 53.1953 68.0489 53.6044 68.2322 54.0542C68.4155 54.5039 68.5083 54.9854 68.5051 55.4711C68.5019 55.9567 68.4029 56.437 68.2137 56.8843C68.0246 57.3316 67.7489 57.7372 67.4027 58.0777Z", fill: "currentColor" }),
      /* @__PURE__ */ jsxRuntime.jsx("path", { d: "M12.161 30.1053C12.532 31.03 13.3822 31.6255 14.3161 31.7237C14.7595 31.768 15.2067 31.6993 15.6149 31.5243C16.0232 31.3492 16.3789 31.0736 16.6481 30.7237C16.9173 30.3739 17.091 29.9614 17.1527 29.5258C17.2143 29.0903 17.1617 28.646 17.0001 28.2356C15.7954 25.2142 15.9385 23.9768 15.9282 23.9758C16.0345 23.6357 16.454 22.6805 18.0343 21.1087C18.5196 20.6258 18.7903 19.9718 18.7869 19.2906C18.7834 18.6093 18.5061 17.9566 18.0159 17.476C17.5257 16.9954 16.8627 16.7263 16.1729 16.7279C15.4831 16.7295 14.8229 17.0016 14.3376 17.4845C12.5791 19.2338 11.4437 20.904 10.9573 22.4462C10.5866 23.6338 10.4946 25.9276 12.161 30.1053Z", fill: "currentColor" }),
      /* @__PURE__ */ jsxRuntime.jsx("path", { d: "M61.3333 4.50207L83 4.5034M61.3333 15.5791L83 15.5805M61.3333 26.656L83 26.6574M53.8333 4.50084H53.85M53.8333 15.5778H53.85M53.8333 26.6547H53.85M54.6667 4.50084C54.6667 5.01063 54.2936 5.42391 53.8333 5.42391C53.3731 5.42391 53 5.01063 53 4.50084C53 3.99104 53.3731 3.57776 53.8333 3.57776C54.2936 3.57776 54.6667 3.99104 54.6667 4.50084ZM54.6667 15.5778C54.6667 16.0875 54.2936 16.5008 53.8333 16.5008C53.3731 16.5008 53 16.0875 53 15.5778C53 15.068 53.3731 14.6547 53.8333 14.6547C54.2936 14.6547 54.6667 15.068 54.6667 15.5778ZM54.6667 26.6547C54.6667 27.1644 54.2936 27.5778 53.8333 27.5778C53.3731 27.5778 53 27.1644 53 26.6547C53 26.145 53.3731 25.7316 53.8333 25.7316C54.2936 25.7316 54.6667 26.145 54.6667 26.6547Z", stroke: "currentColor", "stroke-width": "4", "stroke-linecap": "round", "stroke-linejoin": "round" })
      ]
    });
    var PluginIcon = ({ style }) => /* @__PURE__ */ jsxRuntime.jsxs("svg", {
      style: { width: "24px", height: "24px", ...style }, viewBox: "0 0 24 24", fill: "none", xmlns: "http://www.w3.org/2000/svg", children: [
      /* @__PURE__ */ jsxRuntime.jsx("path", { d: "M15.75 4C15.75 3.58579 15.4142 3.25 15 3.25C14.5858 3.25 14.25 3.58579 14.25 4L14.25 5.052C14.2499 5.95048 14.2499 6.6997 14.3299 7.29448C14.4143 7.92227 14.6 8.48907 15.0554 8.94454C15.5109 9.40001 16.0777 9.58568 16.7055 9.67009C17.1662 9.73202 17.7195 9.74597 18.363 9.7491L17.5315 10.4143C17.208 10.6731 17.1556 11.1451 17.4143 11.4685C17.6731 11.792 18.145 11.8444 18.4685 11.5857L20.9685 9.58565C21.1464 9.44332 21.25 9.22784 21.25 9C21.25 8.77216 21.1464 8.55668 20.9685 8.41435L18.4685 6.41435C18.145 6.15559 17.6731 6.20803 17.4143 6.53148C17.1556 6.85493 17.208 7.32689 17.5315 7.58565L18.3605 8.24888C17.7356 8.24561 17.2729 8.23287 16.9054 8.18346C16.4439 8.12142 16.2464 8.0142 16.1161 7.88388C15.9858 7.75357 15.8786 7.55607 15.8165 7.09461C15.7516 6.61157 15.75 5.96401 15.75 5V4Z", fill: "currentColor" }),
      /* @__PURE__ */ jsxRuntime.jsx("path", { fillRule: "evenodd", clipRule: "evenodd", d: "M10.6925 4.95067C9.52266 2.85455 6.68752 2.72683 5.00745 4.4069C4.10879 5.30556 3.3103 6.50048 3.25706 7.90468C3.17818 9.98561 3.71556 13.4408 7.13735 16.8626C10.5591 20.2844 14.0144 20.8218 16.0953 20.7429C17.4995 20.6897 18.6944 19.8912 19.5931 18.9925C21.2731 17.3125 21.1454 14.4773 19.0493 13.3075L17.8864 12.6585C16.5176 11.8946 14.7905 12.2201 13.6585 13.3384C13.6381 13.3533 13.5231 13.4323 13.3221 13.4421C13.0656 13.4545 12.4729 13.3633 11.5548 12.4452C10.6364 11.5267 10.5454 10.9339 10.5579 10.6776C10.5677 10.4768 10.6467 10.3619 10.6616 10.3415C11.7799 9.2095 12.1054 7.48242 11.3415 6.1136L10.6925 4.95067ZM6.06811 5.46756C7.17394 4.36173 8.78363 4.60832 9.38265 5.68167L10.0317 6.8446C10.4354 7.56801 10.2977 8.58415 9.58435 9.29747C9.51471 9.36712 9.09846 9.81276 9.0597 10.6043C9.02003 11.4146 9.38395 12.3956 10.4942 13.5058C11.604 14.6157 12.5847 14.9797 13.395 14.9403C14.1864 14.9018 14.6322 14.4858 14.7023 14.4158C15.4156 13.7025 16.432 13.5646 17.1554 13.9683L18.3183 14.6173C19.3916 15.2163 19.6382 16.826 18.5324 17.9319C17.7571 18.7072 16.9013 19.2113 16.0385 19.244C14.3031 19.3098 11.2774 18.8813 8.19801 15.802C5.11864 12.7226 4.6902 9.69684 4.75599 7.9615C4.7887 7.09872 5.29276 6.24291 6.06811 5.46756Z", fill: "currentColor" })
      ]
    });
    var Cross = ({ style }) => /* @__PURE__ */ jsxRuntime.jsx("svg", { style, viewBox: "0 0 24 24", fill: "none", xmlns: "http://www.w3.org/2000/svg", children: /* @__PURE__ */ jsxRuntime.jsx("path", { d: "M18 6L6 18M6 6L18 18", stroke: "currentColor", strokeWidth: "2", strokeLinecap: "round", strokeLinejoin: "round" }) });
    var Tick = ({ style }) => /* @__PURE__ */ jsxRuntime.jsx("svg", { style, width: "12", height: "12", viewBox: "0 0 12 12", fill: "none", xmlns: "http://www.w3.org/2000/svg", children: /* @__PURE__ */ jsxRuntime.jsx("path", { d: "M10 3L4.5 8.5L2 6", stroke: "currentColor", strokeWidth: "1.5", strokeLinecap: "round", strokeLinejoin: "round" }) });
    var ChevronDown = () => /* @__PURE__ */ jsxRuntime.jsx("svg", { width: "12", height: "12", viewBox: "0 0 12 12", fill: "none", xmlns: "http://www.w3.org/2000/svg", style: { marginLeft: "4px" }, children: /* @__PURE__ */ jsxRuntime.jsx("path", { d: "M2.5 4.5L6 8L9.5 4.5", stroke: "currentColor", strokeWidth: "1.5", strokeLinecap: "round", strokeLinejoin: "round" }) });
    var index = {
      register(app) {
        app.addMenuLink({
          to: `plugins/${PLUGIN_ID}`,
          icon: PluginIcon,
          intlLabel: {
            id: `${PLUGIN_ID}.plugin.name`,
            defaultMessage: PLUGIN_ID
          },
          Component: async () => {
            const { App } = await Promise.resolve().then(() => require_App_m8etSL3d());
            return App;
          }
        });
        app.registerPlugin({
          id: PLUGIN_ID,
          initializer: Initializer,
          isReady: false,
          name: PLUGIN_ID
        });
      },
      async registerTrads({ locales }) {
        return Promise.all(
          locales.map(async (locale) => {
            try {
              const { default: data } = await __variableDynamicImportRuntimeHelper(/* @__PURE__ */ Object.assign({ "./translations/en.json": () => Promise.resolve().then(() => require_en_B4KWt_jN()) }), `./translations/${locale}.json`, 3);
              return { data, locale };
            } catch {
              return { data: {}, locale };
            }
          })
        );
      }
    };
    exports2.ActiveCall = ActiveCall;
    exports2.CallTime = CallTime;
    exports2.ChevronDown = ChevronDown;
    exports2.CompletedCall = CompletedCall;
    exports2.Cross = Cross;
    exports2.DeclineCall = DeclineCall;
    exports2.Expert = Expert;
    exports2.PluginIcon = PluginIcon;
    exports2.Tick = Tick;
    exports2.TotalCalls = TotalCalls;
    exports2.VideoCall = VideoCall;
    exports2.VoiceCall = VoiceCall;
    exports2.index = index;
  }
});

// dist/admin/index.js
var require_admin = __commonJS({
  "dist/admin/index.js"(exports2, module2) {
    "use strict";
    var index = require_index_D37jjv0();
    module2.exports = index.index;
  }
});

// dist/server/index.js
var require_server = __commonJS({
  "dist/server/index.js"(exports2, module2) {
    "use strict";
    var bootstrap = ({ strapi: strapi2 }) => {
    };
    var destroy = ({ strapi: strapi2 }) => {
    };
    var register = ({ strapi: strapi2 }) => {
      strapi2.documents.use(async (context, next) => {
        const result = await next();
        if ((context.uid === "api::call.call" || context.uid === "api::expert-profile.expert-profile") && (context.action === "create" || context.action === "update")) {
          try {
            await strapi2.plugin("admin-pannel").service("liveCallsService").callsData();
          } catch (error) {
            strapi2.log.error("Error in liveCallsService middleware:", error);
          }
        }
        return result;
      });
    };
    var config = {
      default: {},
      validator() {
      }
    };
    var contentTypes = {};
    var LIST_DELIMITER_REGEX = /[\n,]/;
    var sanitizeDataPayload = (data) => {
      if (!data || typeof data !== "object")
        return void 0;
      return Object.fromEntries(
        Object.entries(data).filter(([, value]) => value !== void 0 && value !== null).map(([key, value]) => [
          key,
          typeof value === "string" ? value : typeof value === "object" ? JSON.stringify(value) : String(value)
        ])
      );
    };
    var tryParseJson = (value) => {
      try {
        return JSON.parse(value);
      } catch {
        return null;
      }
    };
    var pushIfStringList = (rawValue, push, emit) => {
      if (typeof rawValue !== "string") {
        push(rawValue);
        return;
      }
      const trimmed = rawValue.trim();
      if (!trimmed)
        return;
      const firstChar = trimmed[0];
      const lastChar = trimmed[trimmed.length - 1];
      const looksLikeJsonArray = firstChar === "[" && lastChar === "]";
      const looksLikeJsonString = firstChar === `"` && lastChar === `"`;
      if (looksLikeJsonArray || looksLikeJsonString) {
        const parsed = tryParseJson(trimmed);
        if (parsed !== null && parsed !== void 0) {
          push(parsed);
          return;
        }
      }
      if (LIST_DELIMITER_REGEX.test(trimmed)) {
        trimmed.split(LIST_DELIMITER_REGEX).map((segment) => segment.trim()).filter(Boolean).forEach((segment) => push(segment));
        return;
      }
      emit(trimmed);
    };
    var INVALID_FCM_CODES = /* @__PURE__ */ new Set([
      "messaging/registration-token-not-registered",
      "messaging/invalid-registration-token"
    ]);
    var isInvalidFirebaseTokenError = (error) => {
      if (!error)
        return false;
      const code = error.code || error.errorInfo?.code;
      if (code && INVALID_FCM_CODES.has(code))
        return true;
      const message = error.message || error.errorInfo?.message;
      return typeof message === "string" && message.toLowerCase().includes("requested entity was not found");
    };
    async function sendToTokens(tokens, { notification, data, android, apns, ttlSeconds = 300 }) {
      const safeData = sanitizeDataPayload(data);
      const clean = uniqueTokens(normalizeFirebaseTokens(tokens));
      if (clean.length === 0) {
        return { successCount: 0, failureCount: 0, invalidTokens: [] };
      }
      const androidConfig = {
        priority: "high",
        ttl: ttlSeconds * 1e3,
        collapseKey: safeData?.type || "default",
        ...android
      };
      const apnsConfig = {
        headers: { "apns-priority": "10" },
        ...apns
      };
      if (clean.length === 1) {
        try {
          await admin.messaging().send({
            token: clean[0],
            notification,
            data: safeData,
            android: androidConfig,
            apns: apnsConfig
          });
          return { successCount: 1, failureCount: 0, invalidTokens: [] };
        } catch (error) {
          if (isInvalidFirebaseTokenError(error)) {
            return { successCount: 0, failureCount: 1, invalidTokens: clean };
          }
          throw error;
        }
      }
      const res = await admin.messaging().sendEachForMulticast({
        tokens: clean,
        notification,
        data: safeData,
        android: androidConfig,
        apns: apnsConfig
      });
      const invalidTokens = [];
      if (Array.isArray(res?.responses)) {
        res.responses.forEach((response, index2) => {
          if (!response.success && isInvalidFirebaseTokenError(response.error)) {
            invalidTokens.push(clean[index2]);
          }
        });
      }
      return {
        successCount: res.successCount ?? 0,
        failureCount: res.failureCount ?? 0,
        invalidTokens
      };
    }
    var resolvePopulatedEntry = (entry) => {
      if (!entry)
        return null;
      if (Array.isArray(entry)) {
        return resolvePopulatedEntry(entry[0]);
      }
      if (entry?.data) {
        return resolvePopulatedEntry(entry.data);
      }
      return entry;
    };
    var normalizeFirebaseTokens = (value) => {
      if (value === null || value === void 0)
        return [];
      const initial = Array.isArray(value) ? value.flat(Infinity) : [value];
      const tokens = [];
      const emitToken = (token) => {
        if (token === null || token === void 0)
          return;
        tokens.push(String(token));
      };
      const pushValue = (entry) => {
        if (entry === null || entry === void 0)
          return;
        if (Array.isArray(entry)) {
          entry.forEach(pushValue);
          return;
        }
        if (typeof entry === "string") {
          pushIfStringList(entry, pushValue, emitToken);
          return;
        }
        emitToken(entry);
      };
      initial.forEach(pushValue);
      return tokens.filter(Boolean);
    };
    var uniqueTokens = (tokens) => {
      if (!Array.isArray(tokens))
        return [];
      return Array.from(new Set(tokens.filter(Boolean)));
    };
    var DEFAULT_LOGO_URL = "https://callingappdev.s3.ap-south-1.amazonaws.com/avatars/CE_Logo_Icon_e8fa8dff79.png";
    var buildFallback = (overrides = {}) => ({
      name: process.env.PLATFORM_NAME || "Consultease",
      supportEmail: process.env.PLATFORM_SUPPORT_EMAIL || "support@consultease.com",
      logo: DEFAULT_LOGO_URL,
      companyProfile: null,
      monthlyStatementBottomContent: [],
      ...overrides
    });
    var toAbsoluteUrl = (url) => {
      if (!url) {
        return null;
      }
      if (/^https?:\/\//i.test(url)) {
        return url;
      }
      const baseUrl = process.env.STRAPI_ADMIN_BACKEND_URL || process.env.STRAPI_BACKEND_URL || process.env.STRAPI_URL || "";
      if (!baseUrl) {
        return url;
      }
      const normalizedBase = baseUrl.replace(/\/$/, "");
      const normalizedPath = String(url).replace(/^\//, "");
      return `${normalizedBase}/${normalizedPath}`;
    };
    var extractMediaEntry = (media) => {
      if (!media) {
        return null;
      }
      if (Array.isArray(media)) {
        return extractMediaEntry(media[0]);
      }
      if (media?.data) {
        return extractMediaEntry(media.data);
      }
      if (media?.attributes) {
        return extractMediaEntry(media.attributes);
      }
      return media;
    };
    var resolveMediaUrl = (media) => {
      const entry = extractMediaEntry(media);
      if (!entry) {
        return null;
      }
      const url = entry.url || entry.formats?.large?.url || entry.formats?.medium?.url || entry.formats?.small?.url || entry.formats?.thumbnail?.url || null;
      return toAbsoluteUrl(url);
    };
    var normalizeBlocksField = (value) => {
      if (!value) {
        return [];
      }
      if (Array.isArray(value)) {
        return value;
      }
      if (value?.document && Array.isArray(value.document)) {
        return value.document;
      }
      return [];
    };
    async function loadPlatformInfo(strapi2, options = {}) {
      if (!strapi2) {
        throw new Error("A Strapi instance is required to load platform info");
      }
      const fallback = buildFallback(options.fallback);
      const logger = options.logger || strapi2.log;
      const model = typeof strapi2.contentType === "function" && strapi2.contentType("api::app-config.app-config") || typeof strapi2.getModel === "function" && strapi2.getModel("api::app-config.app-config") || {};
      const attrs = model.attributes || {};
      const bottomContentField = (() => {
        if ("monthly_statement_bottom_content" in attrs) {
          return "monthly_statement_bottom_content";
        }
        if ("monthly_statment_bottom_content" in attrs) {
          return "monthly_statment_bottom_content";
        }
        return null;
      })();
      const shouldPopulateBottomContent = bottomContentField && ["relation", "component", "dynamiczone", "media"].includes(
        attrs[bottomContentField]?.type
      );
      try {
        const populate = {
          logo: true,
          company_profile: {
            populate: {
              wallets: true,
              expert: true,
              gst_detail: {
                populate: {
                  GST: {
                    populate: {
                      state: true,
                      country: true,
                      city: true,
                      district: true
                    }
                  }
                }
              }
            }
          }
        };
        if (shouldPopulateBottomContent) {
          populate[bottomContentField] = true;
        }
        const config2 = await strapi2.documents("api::app-config.app-config").findFirst({
          status: "published",
          populate
        });
        if (!config2) {
          return fallback;
        }
        const cpWallets = config2.company_profile?.wallets || [];
        const earningsWallet = cpWallets.find((w) => w.wallet_type === "EARNINGS_WALLET");
        const primaryWallet = earningsWallet || cpWallets[0] || null;
        let companyProfile = {
          name: config2.company_profile?.name || fallback.name,
          supportEmail: config2.supportEmail || "abc@xyz.com",
          logo: resolveMediaUrl(config2.logo) || fallback.logo,
          companyProfile: config2.company_profile,
          monthlyStatementBottomContent: normalizeBlocksField(
            bottomContentField && config2[bottomContentField] || config2.monthly_statement_bottom_content || config2.monthly_statment_bottom_content
          ),
          wallet: primaryWallet,
          // Backwards compatibility / Main usage
          wallets: cpWallets,
          // Expose all if needed
          gstDetail: config2.company_profile?.gst_detail || null,
          expert: config2.company_profile?.expert || null,
          is_live: config2.company_profile?.documentId ? true : false
        };
        return companyProfile;
      } catch (error) {
        if (logger?.warn) {
          logger.warn(
            `[platform-info] Unable to load app-config: ${error.message}`
          );
        } else {
          console.warn("[platform-info] Unable to load app-config:", error);
        }
        return {
          ...fallback
        };
      }
    }
    var getWallet = async (userId, type) => {
      if (!userId)
        return null;
      const wallets = await strapi.entityService.findMany("api::wallet.wallet", {
        filters: {
          user: userId,
          wallet_type: type
        },
        limit: 1
      });
      if (wallets && wallets.length > 0) {
        return wallets[0];
      }
      try {
        const newWallet = await strapi.entityService.create("api::wallet.wallet", {
          data: {
            user: userId,
            balance: 0,
            isActive: true,
            wallet_type: type
          }
        });
        return newWallet;
      } catch (err) {
        strapi.log.error(`Failed to create ${type} wallet for user ${userId}:`, err);
        return null;
      }
    };
    var dashboard = ({ strapi: strapi2 }) => ({
      async stream(ctx) {
        ctx.set("Content-Type", "text/event-stream");
        ctx.set("Cache-Control", "no-cache");
        ctx.set("Connection", "keep-alive");
        ctx.status = 200;
        await strapi2.plugin("admin-pannel").service("liveCallsService").callsData(ctx.res);
        const hb = setInterval(() => {
          try {
            ctx.res.write(`: ping ${Date.now()}

`);
          } catch {
          }
        }, 15e3);
        ctx.req.on("close", () => {
          clearInterval(hb);
          strapi2.plugin("admin-pannel").service("sse").removeClient(ctx.res);
        });
        ctx.respond = false;
      },
      // ----------------------------------------------------------
      // GET /api/call/recent-calls 
      // ----------------------------------------------------------
      async recentCalls(ctx) {
        try {
          let pagination = {};
          let page = 1;
          let pageSize = null;
          const baseFilters = { callStatus: { $notIn: ["pending", "ongoing"] } };
          const clientFilters = ctx.query?.filters || {};
          const filters = { ...baseFilters, ...clientFilters };
          const total = await strapi2.entityService.count("api::call.call", { filters });
          if (ctx.query?.pagination?.pageSize) {
            page = Math.max(1, Number(ctx.query?.pagination?.page) || 1);
            pageSize = Math.min(50, Math.max(1, Number(ctx.query?.pagination?.pageSize)));
            pagination = {
              start: (page - 1) * pageSize,
              limit: pageSize
            };
          }
          const calls = await strapi2.entityService.findMany("api::call.call", {
            filters,
            ...pagination,
            populate: {
              caller: true,
              receiver: { populate: { expert: true } },
              categories: true,
              review: { fields: ["rating"] }
            },
            sort: { createdAt: "desc" }
          });
          const recentCalls = calls.map((call) => ({
            id: call.id,
            type: call.type,
            documentId: call.documentId,
            time: call.startTime,
            duration: call.duration,
            caller: call.caller?.name,
            expert: call.receiver?.name,
            category: call.categories?.[0]?.name,
            rating: call.review?.rating,
            revenue: call.totalCost || 0,
            status: call.callStatus
          }));
          return ctx.send({
            data: recentCalls,
            meta: pageSize ? {
              pagination: {
                page,
                pageSize,
                pageCount: Math.ceil(total / pageSize),
                total
              }
            } : { pagination: { total } }
          });
        } catch (error) {
          strapi2.log.error("recentCalls error", error);
          return ctx.internalServerError(
            error.message || "recentCalls failed"
          );
        }
      },
      // ----------------------------------------------------------
      // GET /api/category-stats
      // ----------------------------------------------------------
      async categoryStats(ctx) {
        try {
          const clientFilters = ctx.query?.filters || {};
          const filters = { ...clientFilters };
          const calls = await strapi2.entityService.findMany("api::call.call", {
            filters,
            fields: ["duration", "totalCost", "type"],
            populate: {
              categories: { fields: ["name"] },
              review: { fields: ["rating"] }
            }
          });
          const map = /* @__PURE__ */ new Map();
          for (const row of calls) {
            const categoryName = row.categories?.[0]?.name?.trim() || "Others";
            const minutes = Number(row.duration || 0);
            const rating = Number(row.review?.rating);
            const hasRating = Number.isFinite(rating);
            const type = row.type;
            if (!map.has(categoryName)) {
              map.set(categoryName, {
                name: categoryName,
                calls: 0,
                videoCalls: 0,
                minutes: 0,
                // revenue: 0,
                _ratingSum: 0,
                _ratingCount: 0
              });
            }
            const agg = map.get(categoryName);
            if (type === "videoCall")
              agg.videoCalls += 1;
            else
              agg.calls += 1;
            agg.minutes += minutes;
            if (hasRating) {
              agg._ratingSum += rating;
              agg._ratingCount += 1;
            }
          }
          const results = Array.from(map.values()).map((x) => ({
            name: x.name,
            calls: x.calls,
            videoCalls: x.videoCalls,
            totalCalls: x.calls + x.videoCalls,
            minutes: Math.ceil(x.minutes),
            // revenue: x.revenue,
            avgRating: x._ratingCount ? Number((x._ratingSum / x._ratingCount).toFixed(1)) : 0
          })).sort((a, b) => b.totalCalls - a.totalCalls);
          return ctx.send(results);
        } catch (error) {
          strapi2.log.error("categoryStats error", error);
          return ctx.internalServerError(error.message || "categoryStats failed");
        }
      },
      // ----------------------------------------------------------
      // POST /admin/callend  (server-side billing & invoice)
      // Also (optionally) notify both sides with CALL_ENDED
      // ----------------------------------------------------------
      async Callend(ctx) {
        console.log("\u{1F514} [Callend] Called");
        try {
          const { callId } = ctx.request.body || {};
          const adminUser = ctx.state.user || {};
          console.log("\u{1F514} [Callend] adminUser", adminUser);
          const endedByInfo = {
            id: adminUser.id,
            name: `${adminUser.firstname || ""} ${adminUser.lastname || ""}`.trim(),
            role: adminUser.roles?.[0]?.name || "Admin",
            documentId: adminUser.documentId
          };
          const endTime = /* @__PURE__ */ new Date();
          if (!callId) {
            console.warn("\u{1F514} [Callend] Missing callId");
            return ctx.badRequest("callId is required");
          }
          const platformInfo = await loadPlatformInfo(strapi2, { logger: strapi2.log });
          if (platformInfo.is_live === false) {
            console.warn("\u{1F514} [Callend] Platform maintenance mode");
            return ctx.badRequest("Platform is under maintenance");
          }
          const existingCall = await strapi2.entityService.findOne(
            "api::call.call",
            callId,
            {
              populate: {
                caller: { populate: ["wallets"] },
                receiver: { populate: ["wallets", "expert", "expert.rates"] }
              }
            }
          );
          if (!existingCall) {
            console.warn("\u{1F514} [Callend] Call not found:", callId);
            return ctx.notFound("Call not found");
          }
          if (existingCall.callStatus === "completed") {
            console.warn("\u{1F514} [Callend] Call already completed:", callId);
            return ctx.badRequest("Call has been Ended already");
          }
          const startTime = existingCall.startTime ? new Date(existingCall.startTime) : null;
          const type = existingCall.type;
          if ((!startTime || isNaN(startTime.getTime())) && existingCall.callStatus === "pending") {
            console.log("\u{1F514} [Callend] Call never started (pending). Marking as declined.");
            const declinedMetadata = {
              reason: "Call ended before start (Declined/Missed)",
              endedByInfo,
              callStatus: "force complete by admin",
              callerId: existingCall.caller.id,
              receiverId: existingCall.receiver.id,
              callerName: existingCall.caller.name,
              receiverName: existingCall.receiver.name,
              callType: existingCall.type,
              callId: existingCall.id
            };
            const declinedCall = await strapi2.entityService.update(
              "api::call.call",
              callId,
              {
                data: {
                  callStatus: "force complete by admin",
                  endTime: endTime || /* @__PURE__ */ new Date(),
                  duration: 0,
                  totalCost: 0,
                  duration_sec: 0,
                  metadata: declinedMetadata
                },
                populate: {
                  caller: { populate: ["wallets"] },
                  receiver: { populate: ["wallets"] }
                }
              }
            );
            try {
              const callerUser = await strapi2.entityService.findOne("api::public-user.public-user", existingCall.caller.id, { fields: ["firebaseTokens"] });
              const receiverUser = await strapi2.entityService.findOne("api::public-user.public-user", existingCall.receiver.id, { fields: ["firebaseTokens"] });
              const tokens = uniqueTokens([...normalizeFirebaseTokens(callerUser?.firebaseTokens), ...normalizeFirebaseTokens(receiverUser?.firebaseTokens)]);
              if (tokens.length) {
                await sendToTokens(tokens, {
                  data: {
                    type: "CALL_ENDED",
                    callId: String(callId),
                    dismissNotification: "true",
                    status: "declined"
                  },
                  android: { priority: "high" }
                });
              }
            } catch (e) {
              console.warn("\u{1F514} [Callend] Notification error:", e);
            }
            return ctx.send({
              success: true,
              call: declinedCall,
              message: "Call declined/cancelled (not started)."
            });
          }
          if (!startTime || isNaN(startTime.getTime())) {
            console.warn("\u{1F514} [Callend] Invalid start time:", existingCall.startTime);
            return ctx.badRequest("Call has no valid start time.");
          }
          const endTimeDate = endTime;
          let durationSec = Math.floor((endTimeDate.getTime() - startTime.getTime()) / 1e3);
          if (durationSec < 0)
            durationSec = 0;
          if (!Number.isFinite(durationSec))
            durationSec = 0;
          const durationMin = (durationSec / 60).toFixed(2);
          const minutes = Math.max(1, Math.ceil(durationSec / 60));
          const receiverRates = existingCall.receiver.expert.rates;
          let rate = 0;
          if (type === "videoCall") {
            rate = receiverRates && receiverRates.videoCallRate != null ? Number(receiverRates.videoCallRate) : 0;
          } else if (type === "voiceCall") {
            rate = receiverRates && receiverRates.voiceCallRate != null ? Number(receiverRates.voiceCallRate) : 0;
          }
          const totalCost = minutes * rate;
          console.log("\u{1F514} [Callend] Calculated:", { durationSec, durationMin, minutes, rate, totalCost });
          const [pricingRaw] = await Promise.all([
            strapi2.entityService.findMany("api::pricing-config.pricing-config", { limit: 1 })
          ]);
          const settings = Array.isArray(pricingRaw) ? pricingRaw[0] : pricingRaw;
          if (!settings) {
            console.warn("\u{1F514} [Callend] Pricing config missing");
            return ctx.badRequest("Pricing config not found.");
          }
          const adminWallet = resolvePopulatedEntry(platformInfo?.wallet);
          if (!adminWallet?.id) {
            const companyProfile = resolvePopulatedEntry(platformInfo?.companyProfile);
            console.warn("\u{1F514} [Callend] Admin wallet missing in platformInfo", {
              companyProfileId: companyProfile?.id,
              platformInfoWallet: platformInfo?.wallet
            });
            return ctx.badRequest("Admin wallet `not found.");
          }
          const caller = existingCall.caller;
          const receiver = existingCall.receiver;
          const callerWallet = await getWallet(caller.id, "CASH_WALLET");
          const receiverWallet = await getWallet(receiver.id, "EARNINGS_WALLET");
          if (!callerWallet) {
            console.warn("\u{1F514} [Callend] Caller CASH_WALLET missing", caller.id);
            return ctx.badRequest("Caller wallet not found.");
          }
          if (!receiverWallet) {
            console.warn("\u{1F514} [Callend] Receiver EARNINGS_WALLET missing/failed create", receiver.id);
            return ctx.badRequest("Receiver wallet error.");
          }
          const commissionPercentagePerMin = type === "voiceCall" ? Number(settings.VoiceCall_Percentage_Commission || 0) : Number(settings.VideoCall_Percentage_Commission || 0);
          const minimumFixedCommission = type === "voiceCall" ? Number(settings.Minimum_VoiceCall_Commission_Fixed || 0) : Number(settings.Minimum_videoCall_Commission_Fixed || 0);
          const costPerMinute = totalCost / (minutes || 1);
          const percentageBasedCommission = costPerMinute * (commissionPercentagePerMin / 100) * minutes;
          const platformFee = Math.max(percentageBasedCommission, minimumFixedCommission);
          const expertPayout = totalCost - platformFee;
          const commonMetadata = {
            callId: String(callId),
            endedByInfo,
            channelName: existingCall.channelName,
            callType: type,
            callerId: caller.id,
            callerName: caller.username || caller.email,
            receiverId: receiver.id,
            receiverName: receiver.username || receiver.email,
            receiverDocId: receiver.expert ? receiver.expert.documentId : "Null",
            startTime,
            endTime,
            durationSec,
            durationMin,
            ratePerMin: rate,
            commissionPercentage: commissionPercentagePerMin,
            minFixedCommission: minimumFixedCommission,
            totalCost,
            platformFee,
            expertEarnings: expertPayout,
            breakdown: {
              rate,
              minutes,
              formula: `${rate} * ${minutes}`
            }
          };
          const updatedCall = await strapi2.entityService.update(
            "api::call.call",
            callId,
            {
              data: {
                callStatus: "force complete by admin",
                endTime,
                duration: Number(durationMin || 0),
                // Actual duration
                totalCost: Number(totalCost || 0),
                // Billed cost (min 1 min)
                type,
                duration_sec: durationSec,
                metadata: commonMetadata
                // Sync metadata
              },
              populate: {
                caller: { populate: ["wallets"] },
                receiver: { populate: ["wallets"] }
              }
            }
          );
          if (minutes <= 0 || totalCost <= 0) {
            try {
              const callerUser = await strapi2.entityService.findOne("api::public-user.public-user", updatedCall.caller.id, { fields: ["firebaseTokens"] });
              const receiverUser = await strapi2.entityService.findOne("api::public-user.public-user", updatedCall.receiver.id, { fields: ["firebaseTokens"] });
              const tokens = uniqueTokens([...normalizeFirebaseTokens(callerUser?.firebaseTokens), ...normalizeFirebaseTokens(receiverUser?.firebaseTokens)]);
              if (tokens.length) {
                await sendToTokens(tokens, {
                  data: { type: "CALL_ENDED", callId: String(callId), dismissNotification: "true" },
                  android: { priority: "high" }
                });
              }
            } catch (e) {
              strapi2.log.warn("CALL_ENDED push skipped:", e?.message || e);
            }
            return ctx.send({
              success: true,
              call: updatedCall,
              message: "Call ended (no billing)."
            });
          }
          const transactionId = `TXN-${Date.now()}`;
          const callChargeTxn = await strapi2.entityService.create(
            "api::transaction.transaction",
            {
              data: {
                amount: totalCost,
                // Amount Charged
                transactionType: "transfer",
                method: "walletTowallet",
                paymentStatus: "success",
                FromWallet: callerWallet.id,
                to_wallet: adminWallet.id,
                // Platform receives full amount
                call: callId,
                transaction_Id: `${transactionId}-CHARGE`,
                Note: `\u20B9 ${totalCost} go from ${caller.username || caller.email} to Platform`,
                metadata: {
                  ...commonMetadata,
                  description: "Call Cost paid to Platform",
                  type: "CALL_CHARGE"
                }
              }
            }
          );
          const expertPayoutTxn = await strapi2.entityService.create(
            "api::transaction.transaction",
            {
              data: {
                amount: expertPayout,
                // Earnings Paid
                transactionType: "transfer",
                method: "walletTowallet",
                paymentStatus: "success",
                FromWallet: adminWallet.id,
                // Platform pays Expert
                to_wallet: receiverWallet.id,
                user: receiver.id,
                // Link to expert user
                call: callId,
                transaction_Id: `${transactionId}`,
                Note: `\u20B9 ${expertPayout} go from Platform to ${receiver.username || receiver.email}`,
                metadata: {
                  ...commonMetadata,
                  description: "Expert Payout from Platform",
                  type: "EXPERT_PAYOUT"
                }
              }
            }
          );
          try {
            if (receiver?.expert?.documentId) {
              try {
                await strapi2.documents("api::expert-profile.expert-profile").update({
                  documentId: receiver.expert.documentId,
                  data: { user_status: "online" }
                });
                strapi2.log.info(
                  `\u2705 Set Expert ${receiver.id} status to 'online' (Call Ended)`
                );
              } catch (statusErr) {
                strapi2.log.error(
                  `Failed to set Expert ${receiver.id} status to 'online' (Call Ended):`,
                  statusErr
                );
              }
            }
            const expertId = receiver?.expert?.id;
            if (expertId) {
              await strapi2.service("api::call.call").incrementExpertDurations({
                expertId,
                minutes: Number(durationMin || 0)
              });
            }
          } catch (e) {
            strapi2.log.warn("incrementExpertDurations failed:", e?.message || e);
          }
          try {
            const callerUser = await strapi2.entityService.findOne("api::public-user.public-user", updatedCall.caller.id, { fields: ["firebaseTokens"] });
            const receiverUser = await strapi2.entityService.findOne("api::public-user.public-user", updatedCall.receiver.id, { fields: ["firebaseTokens"] });
            const tokens = uniqueTokens([...normalizeFirebaseTokens(callerUser?.firebaseTokens), ...normalizeFirebaseTokens(receiverUser?.firebaseTokens)]);
            if (tokens.length) {
              await sendToTokens(tokens, {
                data: { type: "CALL_ENDED", callId: String(callId), dismissNotification: "true" },
                android: { priority: "high" }
              });
            }
          } catch (e) {
            strapi2.log.warn("CALL_ENDED push skipped:", e?.message || e);
          }
          return ctx.send({
            success: true,
            call: updatedCall,
            transactions: [callChargeTxn, expertPayoutTxn],
            message: "Call ended and billed successfully."
          });
        } catch (error) {
          strapi2.log.error("Callend Error:", error);
          return ctx.internalServerError("An error occurred while ending call.");
        }
      }
    });
    var controllers = {
      dashboard
    };
    var middlewares = {};
    var policies = {};
    var routes = {
      "admin-pannel": {
        type: "admin",
        routes: [
          {
            method: "GET",
            path: "/stream",
            handler: "dashboard.stream",
            config: { policies: [], auth: false }
          },
          {
            method: "GET",
            path: "/category-stats",
            handler: "dashboard.categoryStats",
            config: { policies: [] }
          },
          {
            method: "GET",
            path: "/recent-calls",
            handler: "dashboard.recentCalls",
            config: { policies: [], auth: false }
          },
          {
            method: "POST",
            path: "/callend",
            handler: "dashboard.Callend",
            config: { policies: [] }
          }
        ]
      }
    };
    var liveCallsService = ({ strapi: strapi2 }) => ({
      async callsData(res) {
        try {
          const date = /* @__PURE__ */ new Date();
          const today = date.setHours(0, 0, 0, 0);
          const calls = await strapi2.entityService.findMany("api::call.call", {
            filters: { createdAt: { $gte: today } },
            populate: { caller: true, receiver: true, categories: true },
            sort: { createdAt: "desc" }
          });
          const reviews = await strapi2.entityService.findMany("api::review.review", { fields: ["rating"] });
          const experts = await strapi2.entityService.findMany("api::expert-profile.expert-profile");
          const stats = {
            voice: {
              liveCalls: calls.filter((call) => call.callStatus === "ongoing" && call.type === "voiceCall").length,
              callsToday: calls.filter((call) => call.callStatus === "ongoing" && call.type === "voiceCall").length,
              declinedCalls: calls.filter((call) => call.callStatus === "declined" && call.type === "voiceCall").length,
              completedCalls: calls.filter((call) => call.callStatus === "completed" && call.type === "voiceCall").length,
              avgDuration: calls.reduce((total, call) => total + call.duration, 0)
            },
            video: {
              liveCalls: calls.filter((call) => call.callStatus === "ongoing" && call.type === "videoCall").length,
              callsToday: calls.filter((call) => call.callStatus === "ongoing" && call.type === "videoCall").length,
              declinedCalls: calls.filter((call) => call.callStatus === "declined" && call.type === "videoCall").length,
              completedCalls: calls.filter((call) => call.callStatus === "completed" && call.type === "videoCall").length,
              avgDuration: calls.reduce((total, call) => total + call.duration, 0)
            },
            expertsOnline: experts.filter((expert) => expert.isActive).length
          };
          const liveCalls = calls.filter((call) => /ongoing|pending/i.test(call.callStatus)).slice(0, 8).map((call) => {
            return {
              id: call.id,
              documentId: call.documentId,
              caller: call.caller?.name,
              expert: call.receiver?.name,
              type: call.type,
              startTime: call.startTime,
              status: call.callStatus,
              duration: call.duration,
              category: call.categories?.[0]?.name
            };
          });
          if (res) {
            res.write(`data: ${JSON.stringify({ stats, liveCalls })}

`);
            strapi2.plugin("admin-pannel").service("sse").addClient(res);
          } else {
            strapi2.plugin("admin-pannel").service("sse").broadcast({ stats, liveCalls });
          }
        } catch (error) {
          strapi2.log.error("dashboardData error", error);
          return { error: error || "dashboardData failed" };
        }
      }
    });
    var sseService = ({ strapi: strapi2 }) => {
      const clients = /* @__PURE__ */ new Set();
      return {
        addClient(res) {
          clients.add(res);
        },
        removeClient(res) {
          clients.delete(res);
        },
        broadcast(data) {
          for (const client of clients) {
            if (client.destroyed || client.writableEnded) {
              clients.delete(client);
              continue;
            }
            client.write(`data: ${JSON.stringify(data)}

`);
          }
        }
      };
    };
    var services = {
      liveCallsService,
      sse: sseService
    };
    var index = {
      bootstrap,
      destroy,
      register,
      config,
      controllers,
      contentTypes,
      middlewares,
      policies,
      routes,
      services
    };
    module2.exports = index;
  }
});

// <stdin>
require_admin();
require_server();
