{"version":3,"file":"index.js","sources":["../../server/src/bootstrap.js","../../server/src/destroy.js","../../server/src/register.js","../../server/src/config/index.js","../../server/src/content-types/index.js","../../server/src/controllers/dashboard.js","../../server/src/controllers/index.js","../../server/src/middlewares/index.js","../../server/src/policies/index.js","../../server/src/routes/index.js","../../server/src/services/liveCallsService.js","../../server/src/services/sse.js","../../server/src/services/index.js","../../server/src/index.js"],"sourcesContent":["const bootstrap = ({ strapi }) => {\n  // bootstrap phase\n};\n\nexport default bootstrap;\r\n","const destroy = ({ strapi }) => {\n  // destroy phase\n};\n\nexport default destroy;\r\n","const register = ({ strapi }) => {\n  strapi.documents.use(async (context, next) => {\n    const result = await next();\n\n    if ((context.uid === 'api::call.call' || context.uid === 'api::expert-profile.expert-profile') && (context.action === 'create' || context.action === 'update')) {\n      try {\n        await strapi.plugin('admin-pannel').service(\"liveCallsService\").callsData();\n      } catch (error) {\n        strapi.log.error(\"Error in liveCallsService middleware:\", error);\n      }\n    }\n\n    return result;\n  });\n};\n\nexport default register;","export default {\n  default: {},\n  validator() {},\n};\r\n","export default {};\r\n","const DEFAULT_LOGO_URL = \"https://callingappdev.s3.ap-south-1.amazonaws.com/avatars/CE_Logo_Icon_e8fa8dff79.png\";\nconst LIST_DELIMITER_REGEX = /[\\n,]/;\n\nconst toAbsoluteUrl = (url) => {\n  if (!url) return null;\n  if (/^https?:\\/\\//i.test(url)) return url;\n  const baseUrl = process.env.STRAPI_ADMIN_BACKEND_URL || process.env.STRAPI_BACKEND_URL || process.env.STRAPI_URL || \"\";\n  if (!baseUrl) return url;\n  const normalizedBase = baseUrl.replace(/\\/$/, \"\");\n  const normalizedPath = String(url).replace(/^\\//, \"\");\n  return `${normalizedBase}/${normalizedPath}`;\n};\n\nconst normalizeBlocksField = (value) => {\n  if (!value) return [];\n  if (Array.isArray(value)) return value;\n  if (value?.document && Array.isArray(value.document)) return value.document;\n  return [];\n};\n\nconst sanitizeDataPayload = (data) => {\n  if (!data || typeof data !== \"object\") return undefined;\n  return Object.fromEntries(\n    Object.entries(data)\n      .filter(([, value]) => value !== undefined && value !== null)\n      .map(([key, value]) => [\n        key,\n        typeof value === \"string\" ? value : typeof value === \"object\" ? JSON.stringify(value) : String(value),\n      ])\n  );\n};\n\nconst tryParseJson = (value) => {\n  try { return JSON.parse(value); } catch { return null; }\n};\n\nconst pushIfStringList = (rawValue, push, emit) => {\n  if (typeof rawValue !== \"string\") {\n    push(rawValue);\n    return;\n  }\n  const trimmed = rawValue.trim();\n  if (!trimmed) return;\n  const firstChar = trimmed[0];\n  const lastChar = trimmed[trimmed.length - 1];\n  const looksLikeJsonArray = firstChar === \"[\" && lastChar === \"]\";\n  const looksLikeJsonString = firstChar === `\"` && lastChar === `\"`;\n  if (looksLikeJsonArray || looksLikeJsonString) {\n    const parsed = tryParseJson(trimmed);\n    if (parsed !== null && parsed !== undefined) {\n      push(parsed);\n      return;\n    }\n  }\n  if (LIST_DELIMITER_REGEX.test(trimmed)) {\n    trimmed.split(LIST_DELIMITER_REGEX).map((segment) => segment.trim()).filter(Boolean).forEach((segment) => push(segment));\n    return;\n  }\n  emit(trimmed);\n};\n\nconst INVALID_FCM_CODES = new Set([\n  \"messaging/registration-token-not-registered\",\n  \"messaging/invalid-registration-token\",\n]);\n\nconst isInvalidFirebaseTokenError = (error) => {\n  if (!error) return false;\n  const code = error.code || error.errorInfo?.code;\n  if (code && INVALID_FCM_CODES.has(code)) return true;\n  const message = error.message || error.errorInfo?.message;\n  return typeof message === \"string\" && message.toLowerCase().includes(\"requested entity was not found\");\n};\n\nconst buildFallback = (overrides = {}) => ({\n  name: process.env.PLATFORM_NAME || \"Consultease\",\n  supportEmail: process.env.PLATFORM_SUPPORT_EMAIL || \"support@consultease.com\",\n  logo: DEFAULT_LOGO_URL,\n  companyProfile: null,\n  monthlyStatementBottomContent: [],\n  ...overrides,\n});\n\nconst resolveMediaUrl = (media) => {\n  const entry = extractMediaEntry(media);\n  if (!entry) {\n    return null;\n  }\n\n  const url =\n    entry.url ||\n    entry.formats?.large?.url ||\n    entry.formats?.medium?.url ||\n    entry.formats?.small?.url ||\n    entry.formats?.thumbnail?.url ||\n    null;\n\n  return toAbsoluteUrl(url);\n};\n\nconst extractMediaEntry = (media) => {\n  if (!media) {\n    return null;\n  }\n\n  if (Array.isArray(media)) {\n    return extractMediaEntry(media[0]);\n  }\n\n  if (media?.data) {\n    return extractMediaEntry(media.data);\n  }\n\n  if (media?.attributes) {\n    return extractMediaEntry(media.attributes);\n  }\n\n  return media;\n};\n\nasync function sendToTokens(\n  tokens,\n  { notification, data, android, apns, ttlSeconds = 300 }\n) {\n  const safeData = sanitizeDataPayload(data);\n  const clean = uniqueTokens(normalizeFirebaseTokens(tokens));\n  if (clean.length === 0) {\n    return { successCount: 0, failureCount: 0, invalidTokens: [] };\n  }\n\n  const androidConfig = {\n    priority: \"high\",\n    ttl: ttlSeconds * 1000,\n    collapseKey: safeData?.type || \"default\",\n    ...android,\n  };\n\n  const apnsConfig = {\n    headers: { \"apns-priority\": \"10\" },\n    ...apns,\n  };\n\n  if (clean.length === 1) {\n    try {\n      await admin.messaging().send({\n        token: clean[0],\n        notification,\n        data: safeData,\n        android: androidConfig,\n        apns: apnsConfig,\n      });\n      return { successCount: 1, failureCount: 0, invalidTokens: [] };\n    } catch (error) {\n      if (isInvalidFirebaseTokenError(error)) {\n        return { successCount: 0, failureCount: 1, invalidTokens: clean };\n      }\n      throw error;\n    }\n  }\n\n  const res = await admin.messaging().sendEachForMulticast({\n    tokens: clean,\n    notification,\n    data: safeData,\n    android: androidConfig,\n    apns: apnsConfig,\n  });\n  const invalidTokens = [];\n  if (Array.isArray(res?.responses)) {\n    res.responses.forEach((response, index) => {\n      if (!response.success && isInvalidFirebaseTokenError(response.error)) {\n        invalidTokens.push(clean[index]);\n      }\n    });\n  }\n  return {\n    successCount: res.successCount ?? 0,\n    failureCount: res.failureCount ?? 0,\n    invalidTokens,\n  };\n}\n\nconst resolvePopulatedEntry = (entry) => {\n  if (!entry) return null;\n  if (Array.isArray(entry)) {\n    return resolvePopulatedEntry(entry[0]);\n  }\n  if (entry?.data) {\n    return resolvePopulatedEntry(entry.data);\n  }\n  return entry;\n};\n\nconst normalizeFirebaseTokens = (value) => {\n  if (value === null || value === undefined) return [];\n  const initial = Array.isArray(value) ? value.flat(Infinity) : [value];\n  const tokens = [];\n  const emitToken = (token) => {\n    if (token === null || token === undefined) return;\n    tokens.push(String(token));\n  };\n\n  const pushValue = (entry) => {\n    if (entry === null || entry === undefined) return;\n    if (Array.isArray(entry)) {\n      entry.forEach(pushValue);\n      return;\n    }\n\n    if (typeof entry === \"string\") {\n      pushIfStringList(entry, pushValue, emitToken);\n      return;\n    }\n\n    emitToken(entry);\n  };\n\n  initial.forEach(pushValue);\n  return tokens.filter(Boolean);\n};\n\nconst uniqueTokens = (tokens) => {\n  if (!Array.isArray(tokens)) return [];\n  return Array.from(new Set(tokens.filter(Boolean)));\n};\n\nasync function loadPlatformInfo(strapi, options = {}) {\n  if (!strapi) {\n    throw new Error(\"A Strapi instance is required to load platform info\");\n  }\n\n  const fallback = buildFallback(options.fallback);\n  const logger = options.logger || strapi.log;\n\n  const model =\n    (typeof strapi.contentType === \"function\" &&\n      strapi.contentType(\"api::app-config.app-config\")) ||\n    (typeof strapi.getModel === \"function\" &&\n      strapi.getModel(\"api::app-config.app-config\")) ||\n    {};\n\n  const attrs = model.attributes || {};\n  const bottomContentField = (() => {\n    if (\"monthly_statement_bottom_content\" in attrs) {\n      return \"monthly_statement_bottom_content\";\n    }\n    if (\"monthly_statment_bottom_content\" in attrs) {\n      return \"monthly_statment_bottom_content\";\n    }\n    return null;\n  })();\n\n  const shouldPopulateBottomContent =\n    bottomContentField &&\n    [\"relation\", \"component\", \"dynamiczone\", \"media\"].includes(\n      attrs[bottomContentField]?.type\n    );\n\n  try {\n    const populate = {\n      logo: true,\n      company_profile: {\n        populate: {\n          wallet: true,\n          expert: true,\n          gst_detail: {\n            populate: {\n              GST: {\n                populate: {\n                  state: true,\n                  country: true,\n                  city: true,\n                  district: true,\n                },\n              },\n            },\n          },\n        },\n      },\n    };\n\n    if (shouldPopulateBottomContent) {\n      populate[bottomContentField] = true;\n    }\n\n    const config = await strapi\n      .documents(\"api::app-config.app-config\")\n      .findFirst({\n        status: \"published\",\n        populate,\n      });\n\n    if (!config) {\n      return fallback;\n    }\n    let companyProfile = {\n      name: config.company_profile?.name || fallback.name,\n      supportEmail: config.supportEmail || \"abc@xyz.com\",\n      logo: resolveMediaUrl(config.logo) || fallback.logo,\n      companyProfile: config.company_profile,\n      monthlyStatementBottomContent: normalizeBlocksField(\n        (bottomContentField && config[bottomContentField]) ||\n        config.monthly_statement_bottom_content ||\n        config.monthly_statment_bottom_content\n      ),\n      wallet: config.company_profile?.wallet || null,\n      gstDetail: config.company_profile?.gst_detail || null,\n      expert: config.company_profile?.expert || null,\n      is_live: config.company_profile?.documentId ? true : false,\n    };\n\n    // console.log(\"Loaded platform config:\", companyProfile);\n    return companyProfile;\n  } catch (error) {\n    if (logger?.warn) {\n      logger.warn(\n        `[platform-info] Unable to load app-config: ${error.message}`\n      );\n    } else {\n      console.warn(\"[platform-info] Unable to load app-config:\", error);\n    }\n\n    return {\n      ...fallback,\n    };\n  }\n}\n\n\nconst dashboard = ({ strapi }) => ({\n  async stream(ctx) {\n    ctx.set(\"Content-Type\", \"text/event-stream\");\n    ctx.set(\"Cache-Control\", \"no-cache\");\n    ctx.set(\"Connection\", \"keep-alive\");\n    ctx.status = 200;\n\n    await strapi.plugin('admin-pannel').service(\"liveCallsService\").callsData(ctx.res);\n\n    const hb = setInterval(() => {\n      try { ctx.res.write(`: ping ${Date.now()}\\n\\n`); } catch { }\n    }, 15000);\n\n    ctx.req.on('close', () => {\n      clearInterval(hb);\n      strapi.plugin('admin-pannel').service('sse').removeClient(ctx.res);\n    });\n\n    ctx.respond = false;\n  },\n\n  // ----------------------------------------------------------\n  // GET /api/call/recent-calls \n  // ----------------------------------------------------------\n  async recentCalls(ctx) {\n    try {\n      let pagination = {};\n      let page = 1;\n      let pageSize = null;\n\n      const baseFilters = { callStatus: { $notIn: [\"pending\", \"ongoing\"] } };\n      const clientFilters = ctx.query?.filters || {};\n      const filters = { ...baseFilters, ...clientFilters };\n      const total = await strapi.entityService.count(\"api::call.call\", { filters });\n\n      if (ctx.query?.pagination?.pageSize) {\n        page = Math.max(1, Number(ctx.query?.pagination?.page) || 1);\n        pageSize = Math.min(50, Math.max(1, Number(ctx.query?.pagination?.pageSize)));\n\n        pagination = {\n          start: (page - 1) * pageSize,\n          limit: pageSize,\n        };\n      }\n\n      const calls = await strapi.entityService.findMany(\"api::call.call\", {\n        filters,\n        ...pagination,\n        populate: {\n          caller: true,\n          receiver: { populate: { expert: true } },\n          categories: true,\n          review: { fields: [\"rating\"] },\n        },\n        sort: { createdAt: \"desc\" },\n      });\n\n      const recentCalls = calls.map((call) => ({\n        id: call.id,\n        type: call.type,\n        documentId: call.documentId,\n        time: call.startTime,\n        duration: call.duration,\n        caller: call.caller?.name,\n        expert: call.receiver?.name,\n        category: call.categories?.[0]?.name,\n        rating: call.review?.rating,\n        revenue: call.totalCost || 0,\n        status: call.callStatus,\n      }));\n\n      return ctx.send({\n        data: recentCalls,\n        meta: pageSize ? {\n          pagination: {\n            page,\n            pageSize,\n            pageCount: Math.ceil(total / pageSize),\n            total,\n          },\n        }\n          : { pagination: { total } },\n      });\n    } catch (error) {\n      strapi.log.error(\"recentCalls error\", error);\n      return ctx.internalServerError(\n        error.message || \"recentCalls failed\"\n      );\n    }\n  },\n\n  // ----------------------------------------------------------\n  // GET /api/category-stats\n  // ----------------------------------------------------------\n  async categoryStats(ctx) {\n    try {\n      // const baseFilters = { callStatus: { $in: [\"completed\",] } };\n      const clientFilters = ctx.query?.filters || {};\n      const filters = { ...clientFilters };\n\n      const calls = await strapi.entityService.findMany(\"api::call.call\", {\n        filters,\n        fields: [\"duration\", \"totalCost\", \"type\"],\n        populate: {\n          categories: { fields: [\"name\"] },\n          review: { fields: [\"rating\"] },\n        },\n      });\n\n      const map = new Map();\n\n      for (const row of calls) {\n        const categoryName = row.categories?.[0]?.name?.trim() || \"Others\";\n\n        const minutes = Number(row.duration || 0);\n        // const revenue = Number(row.totalCost || 0);\n        const rating = Number(row.review?.rating);\n        const hasRating = Number.isFinite(rating);\n        const type = row.type;\n\n        if (!map.has(categoryName)) {\n          map.set(categoryName, {\n            name: categoryName,\n            calls: 0,\n            videoCalls: 0,\n            minutes: 0,\n            // revenue: 0,\n            _ratingSum: 0,\n            _ratingCount: 0,\n          });\n        }\n\n        const agg = map.get(categoryName);\n\n        if (type === \"videoCall\") agg.videoCalls += 1;\n        else agg.calls += 1;\n\n        agg.minutes += minutes;\n        // agg.revenue += revenue;\n\n        if (hasRating) {\n          agg._ratingSum += rating;\n          agg._ratingCount += 1;\n        }\n      }\n\n      const results = Array.from(map.values())\n        .map((x) => ({\n          name: x.name,\n          calls: x.calls,\n          videoCalls: x.videoCalls,\n          totalCalls: x.calls + x.videoCalls,\n          minutes: Math.ceil(x.minutes),\n          // revenue: x.revenue,\n          avgRating: x._ratingCount ? Number((x._ratingSum / x._ratingCount).toFixed(1)) : 0,\n        }))\n        .sort((a, b) => b.totalCalls - a.totalCalls);\n\n      return ctx.send(results);\n\n    } catch (error) {\n      strapi.log.error(\"categoryStats error\", error);\n      return ctx.internalServerError(error.message || \"categoryStats failed\");\n    }\n  },\n\n  // ----------------------------------------------------------\n  // POST /admin/callend  (server-side billing & invoice)\n  // Also (optionally) notify both sides with CALL_ENDED\n  // ----------------------------------------------------------\n\n  async Callend(ctx) {\n    console.log(\"ðŸ”” [Callend] Called\");\n    try {\n      // Step 1: Validation & Setup\n      const { callId } = ctx.request.body || {};\n      const adminUser = ctx.state.user || {};\n      console.log(\"ðŸ”” [Callend] adminUser\", adminUser);\n      // if (!adminUser) {\n      //     return ctx.unauthorized(\"Authentication required. This API must be called from the admin panel.\");\n      // }\n\n      const endedByInfo = {\n        id: adminUser.id,\n        name: `${adminUser.firstname || ''} ${adminUser.lastname || ''}`.trim(),\n        role: adminUser.roles?.[0]?.name || 'Admin',\n        documentId: adminUser.documentId\n      };\n\n      // Secure: Force Server Time for accurate billing\n      const endTime = new Date();\n\n      if (!callId) {\n        console.warn(\"ðŸ”” [Callend] Missing callId\");\n        return ctx.badRequest(\"callId is required\");\n      }\n\n      // Check Platform Status\n      const platformInfo = await loadPlatformInfo(strapi, { logger: strapi.log });\n      if (platformInfo.is_live === false) {\n        console.warn(\"ðŸ”” [Callend] Platform maintenance mode\");\n        return ctx.badRequest(\"Platform is under maintenance\");\n      }\n\n      const existingCall = await strapi.entityService.findOne(\n        \"api::call.call\",\n        callId,\n        {\n          populate: {\n            caller: { populate: [\"wallet\"] },\n            receiver: { populate: [\"wallet\", \"expert\", \"expert.rates\"] },\n          },\n        }\n      );\n\n      if (!existingCall) {\n        console.warn(\"ðŸ”” [Callend] Call not found:\", callId);\n        return ctx.notFound(\"Call not found\");\n      }\n      if (existingCall.callStatus === \"completed\") {\n        console.warn(\"ðŸ”” [Callend] Call already completed:\", callId);\n        return ctx.badRequest(\"Call has been Ended already\");\n      }\n\n      const startTime = existingCall.startTime ? new Date(existingCall.startTime) : null;\n      const type = existingCall.type;\n\n\n      // Handle \"Pending\" Calls (Never Started) -> Mark as Declined\n      if ((!startTime || isNaN(startTime.getTime())) && existingCall.callStatus === \"pending\") {\n        console.log(\"ðŸ”” [Callend] Call never started (pending). Marking as declined.\");\n\n        const declinedMetadata = {\n          reason: \"Call ended before start (Declined/Missed)\",\n          endedByInfo,\n          callStatus: \"declined\",\n          callerId: existingCall.caller.id,\n          receiverId: existingCall.receiver.id,\n          callerName: existingCall.caller.name,\n          receiverName: existingCall.receiver.name,\n          callType: existingCall.type,\n          callId: existingCall.id,\n        };\n\n        const declinedCall = await strapi.entityService.update(\n          \"api::call.call\",\n          callId,\n          {\n            data: {\n              callStatus: \"declined\",\n              endTime: endTime || new Date(),\n              duration: 0,\n              totalCost: 0,\n              duration_sec: 0,\n              metadata: declinedMetadata\n            },\n            populate: {\n              caller: { populate: [\"wallet\"] },\n              receiver: { populate: [\"wallet\"] }\n            }\n          }\n        );\n\n        // Notifications\n        try {\n          const callerUser = await strapi.entityService.findOne(\"api::public-user.public-user\", existingCall.caller.id, { fields: [\"firebaseTokens\"] });\n          const receiverUser = await strapi.entityService.findOne(\"api::public-user.public-user\", existingCall.receiver.id, { fields: [\"firebaseTokens\"] });\n          const tokens = uniqueTokens([...normalizeFirebaseTokens(callerUser?.firebaseTokens), ...normalizeFirebaseTokens(receiverUser?.firebaseTokens)]);\n\n          if (tokens.length) {\n            await sendToTokens(tokens, {\n              data: {\n                type: \"CALL_ENDED\",\n                callId: String(callId),\n                dismissNotification: \"true\",\n                status: \"declined\"\n              },\n              android: { priority: \"high\" },\n            });\n          }\n        } catch (e) { console.warn(\"ðŸ”” [Callend] Notification error:\", e); }\n\n        return ctx.send({\n          success: true,\n          call: declinedCall,\n          message: \"Call declined/cancelled (not started).\",\n        });\n      }\n\n      if (!startTime || isNaN(startTime.getTime())) {\n        console.warn(\"ðŸ”” [Callend] Invalid start time:\", existingCall.startTime);\n        return ctx.badRequest(\"Call has no valid start time.\");\n      }\n\n      // Use the server-generated endTime\n      const endTimeDate = endTime;\n\n      // Step 2: Duration & Cost Calculation\n      let durationSec = Math.floor((endTimeDate.getTime() - startTime.getTime()) / 1000);\n\n      // Guard against negative duration or overflow (e.g. if system time was wrong)\n      if (durationSec < 0) durationSec = 0;\n      // But let's just ensure it's finite.\n      if (!Number.isFinite(durationSec)) durationSec = 0;\n\n      const durationMin = (durationSec / 60).toFixed(2);\n      // Ensure minimum duration is 1 minute, and always round UP to the next full minute (e.g. 1.02 -> 2)\n      const minutes = Math.max(1, Math.ceil(durationSec / 60));\n\n      const receiverRates = existingCall.receiver.expert.rates;\n      let rate = 0;\n      if (type === 'videoCall') {\n        rate = receiverRates && receiverRates.videoCallRate != null ? Number(receiverRates.videoCallRate) : 0;\n      } else if (type === 'voiceCall') {\n        rate = receiverRates && receiverRates.voiceCallRate != null ? Number(receiverRates.voiceCallRate) : 0;\n      }\n\n      const totalCost = minutes * rate; // CALL_CHARGE amount\n\n      console.log(\"ðŸ”” [Callend] Calculated:\", { durationSec, durationMin, minutes, rate, totalCost });\n\n\n      // Step 3: Billing Configuration & Wallets\n      const [pricingRaw] = await Promise.all([\n        strapi.entityService.findMany(\"api::pricing-config.pricing-config\", { limit: 1 }),\n      ]);\n      const settings = Array.isArray(pricingRaw) ? pricingRaw[0] : pricingRaw;\n      if (!settings) {\n        console.warn(\"ðŸ”” [Callend] Pricing config missing\");\n        return ctx.badRequest(\"Pricing config not found.\");\n      }\n\n      const companyProfile = resolvePopulatedEntry(platformInfo?.companyProfile);\n      const adminWallet = resolvePopulatedEntry(companyProfile?.wallet);\n      if (!adminWallet?.id) {\n        console.warn(\"ðŸ”” [Callend] Admin wallet missing\", { companyProfileId: companyProfile?.id, adminWalletId: adminWallet?.id });\n        return ctx.badRequest(\"Admin wallet not found.\");\n      }\n\n      const caller = existingCall.caller;\n      const receiver = existingCall.receiver;\n      const callerWallet = caller.wallet;\n      let receiverWallet = receiver.wallet;\n\n      if (!callerWallet) {\n        console.warn(\"ðŸ”” [Callend] Caller wallet missing\", caller.id);\n        return ctx.badRequest(\"Caller wallet not found.\");\n      }\n      if (!receiverWallet) {\n        receiverWallet = await strapi.entityService.create(\n          \"api::wallet.wallet\",\n          {\n            data: { balance: 0, user: receiver.id, transactions: [] },\n          }\n        );\n      }\n\n      // Step 4: Commission & Payout Calculation\n      const commissionPercentagePerMin = type === \"voiceCall\"\n        ? Number(settings.VoiceCall_Percentage_Commission || 0)\n        : Number(settings.VideoCall_Percentage_Commission || 0);\n\n      const minimumFixedCommission = type === \"voiceCall\"\n        ? Number(settings.Minimum_VoiceCall_Commission_Fixed || 0)\n        : Number(settings.Minimum_videoCall_Commission_Fixed || 0);\n\n      // Total Commission Calculation\n      const costPerMinute = totalCost / (minutes || 1);\n      const percentageBasedCommission = costPerMinute * (commissionPercentagePerMin / 100) * minutes;\n      const platformFee = Math.max(percentageBasedCommission, minimumFixedCommission); // Commission Amount\n\n      const expertPayout = totalCost - platformFee; // EXPERT_PAYOUT amount\n\n      const commonMetadata = {\n        callId: String(callId),\n        endedByInfo,\n        channelName: existingCall.channelName,\n        callType: type,\n        callerId: caller.id,\n        callerName: caller.username || caller.email,\n        receiverId: receiver.id,\n        receiverName: receiver.username || receiver.email,\n        receiverDocId: receiver.expert ? receiver.expert.documentId : \"Null\",\n        startTime: startTime,\n        endTime: endTime,\n        durationSec,\n        durationMin,\n        ratePerMin: rate,\n        commissionPercentage: commissionPercentagePerMin,\n        minFixedCommission: minimumFixedCommission,\n        totalCost: totalCost,\n        platformFee: platformFee,\n        expertEarnings: expertPayout,\n        breakdown: {\n          rate: rate,\n          minutes: minutes,\n          formula: `${rate} * ${minutes}`\n        }\n      };\n\n      // Step 5: Update Call Entity (Pre-transaction)\n      const updatedCall = await strapi.entityService.update(\"api::call.call\", callId,\n        {\n          data: {\n            callStatus: \"force complete by admin\",\n            endTime: endTime,\n            duration: Number(durationMin || 0), // Actual duration\n            totalCost: Number(totalCost || 0), // Billed cost (min 1 min)\n            type,\n            duration_sec: durationSec,\n            metadata: commonMetadata, // Sync metadata\n          },\n          populate: {\n            caller: { populate: [\"wallet\"] },\n            receiver: { populate: [\"wallet\"] }\n          }\n        }\n      );\n\n      // Check validity for billing\n      if (minutes <= 0 || totalCost <= 0) {\n        // Notify logic for no billing\n        try {\n          const callerUser = await strapi.entityService.findOne(\"api::public-user.public-user\", updatedCall.caller.id, { fields: [\"firebaseTokens\"] });\n          const receiverUser = await strapi.entityService.findOne(\"api::public-user.public-user\", updatedCall.receiver.id, { fields: [\"firebaseTokens\"] });\n          const tokens = uniqueTokens([...normalizeFirebaseTokens(callerUser?.firebaseTokens), ...normalizeFirebaseTokens(receiverUser?.firebaseTokens)]);\n          if (tokens.length) {\n            await sendToTokens(tokens, {\n              data: { type: \"CALL_ENDED\", callId: String(callId), dismissNotification: \"true\" },\n              android: { priority: \"high\" },\n            });\n          }\n        } catch (e) { strapi.log.warn(\"CALL_ENDED push skipped:\", e?.message || e); }\n\n        return ctx.send({\n          success: true,\n          call: updatedCall,\n          message: \"Call ended (no billing).\",\n        });\n      }\n\n      // Step 6: Transactions (One Platform Wallet Model)\n      const transactionId = `TXN-${Date.now()}`;\n\n      // 6.1 Transaction: Caller -> Platform (CALL_CHARGE)\n      const callChargeTxn = await strapi.entityService.create(\"api::transaction.transaction\",\n        {\n          data: {\n            amount: totalCost, // Amount Charged\n            transactionType: \"transfer\",\n            method: \"walletTowallet\",\n            paymentStatus: \"success\",\n            FromWallet: callerWallet.id,\n            to_wallet: adminWallet.id, // Platform receives full amount\n            call: callId,\n            transaction_Id: `${transactionId}-CHARGE`,\n            Note: `â‚¹ ${totalCost} go from ${caller.username || caller.email} to Platform`,\n            metadata: {\n              ...commonMetadata,\n              description: \"Call Cost paid to Platform\",\n              type: \"CALL_CHARGE\"\n            },\n          },\n        }\n      );\n\n      // 6.2 Transaction: Platform -> Expert (EXPERT_PAYOUT)\n      const expertPayoutTxn = await strapi.entityService.create(\n        \"api::transaction.transaction\",\n        {\n          data: {\n            amount: expertPayout, // Earnings Paid\n            transactionType: \"transfer\",\n            method: \"walletTowallet\",\n            paymentStatus: \"success\",\n            FromWallet: adminWallet.id, // Platform pays Expert\n            to_wallet: receiverWallet.id,\n            user: receiver.id, // Link to expert user\n            call: callId,\n            transaction_Id: `${transactionId}`,\n            Note: `â‚¹ ${expertPayout} go from Platform to ${receiver.username || receiver.email}`,\n            metadata: {\n              ...commonMetadata,\n              description: \"Expert Payout from Platform\",\n              type: \"EXPERT_PAYOUT\"\n            },\n          },\n        }\n      );\n\n      // Step 7: Update Expert Stats\n      try {\n        // âœ… NEW: Set Receiver Expert Status to 'online' (Call Ended)\n        if (receiver?.expert?.documentId) {\n          try {\n            await strapi.documents(\"api::expert-profile.expert-profile\").update({\n              documentId: receiver.expert.documentId,\n              data: { user_status: \"online\" },\n            });\n            strapi.log.info(\n              `âœ… Set Expert ${receiver.id} status to 'online' (Call Ended)`\n            );\n          } catch (statusErr) {\n            strapi.log.error(\n              `Failed to set Expert ${receiver.id} status to 'online' (Call Ended):`,\n              statusErr\n            );\n          }\n        }\n\n        const expertId = receiver?.expert?.id;\n        if (expertId) {\n          await strapi.service(\"api::call.call\").incrementExpertDurations({\n            expertId,\n            minutes: Number(durationMin || 0),\n          });\n        }\n      } catch (e) {\n        strapi.log.warn(\"incrementExpertDurations failed:\", e?.message || e);\n      }\n\n      // Step 8: Final Notification (UI Sync)\n      try {\n        const callerUser = await strapi.entityService.findOne(\"api::public-user.public-user\", updatedCall.caller.id, { fields: [\"firebaseTokens\"] });\n        const receiverUser = await strapi.entityService.findOne(\"api::public-user.public-user\", updatedCall.receiver.id, { fields: [\"firebaseTokens\"] });\n        const tokens = uniqueTokens([...normalizeFirebaseTokens(callerUser?.firebaseTokens), ...normalizeFirebaseTokens(receiverUser?.firebaseTokens)]);\n        if (tokens.length) {\n          await sendToTokens(tokens, {\n            data: { type: \"CALL_ENDED\", callId: String(callId), dismissNotification: \"true\" },\n            android: { priority: \"high\" },\n          });\n        }\n      } catch (e) { strapi.log.warn(\"CALL_ENDED push skipped:\", e?.message || e); }\n\n      return ctx.send({\n        success: true,\n        call: updatedCall,\n        transactions: [callChargeTxn, expertPayoutTxn],\n        message: \"Call ended and billed successfully.\",\n      });\n\n    } catch (error) {\n      strapi.log.error(\"Callend Error:\", error);\n      return ctx.internalServerError(\"An error occurred while ending call.\");\n    }\n  },\n});\n\nexport default dashboard;","import dashboard from './dashboard';\r\n\r\nexport default {\r\n    dashboard,\r\n};","export default {};\r\n","export default {};\r\n","'use strict';\r\n\r\nexport default {\r\n    'admin-pannel': {\r\n        type: 'admin',\r\n        routes: [\r\n            {\r\n                method: \"GET\",\r\n                path: \"/stream\",\r\n                handler: \"dashboard.stream\",\r\n                config: { policies: [], auth: false },\r\n            },\r\n            {\r\n                method: \"GET\",\r\n                path: \"/category-stats\",\r\n                handler: \"dashboard.categoryStats\",\r\n                config: { policies: [] },\r\n            },\r\n            {\r\n                method: \"GET\",\r\n                path: \"/recent-calls\",\r\n                handler: \"dashboard.recentCalls\",\r\n                config: { policies: [], auth: false },\r\n            },\r\n            {\r\n                method: 'POST',\r\n                path: '/callend',\r\n                handler: 'dashboard.Callend',\r\n                config: { policies: [] },\r\n            },\r\n        ],\r\n    },\r\n};","const liveCallsService = ({ strapi }) => ({\n  async callsData(res) {\n    try {\n      const date = new Date();\n      const today = date.setHours(0, 0, 0, 0);\n\n      const calls = await strapi.entityService.findMany(\"api::call.call\", {\n        filters: { createdAt: { $gte: today } },\n        populate: { caller: true, receiver: true, categories: true },\n        sort: { createdAt: 'desc' },\n      });\n\n      const reviews = await strapi.entityService.findMany(\"api::review.review\", { fields: [\"rating\"] });\n      const experts = await strapi.entityService.findMany(\"api::expert-profile.expert-profile\");\n\n      const stats = {\n        liveCalls: calls.filter((call) => call.callStatus === \"ongoing\").length,\n        voiceCalls: calls.filter((call) => call.type === \"voiceCall\").length,\n        videoCalls: calls.filter((call) => call.type === \"videoCall\").length,\n        expertsOnline: experts.filter((expert) => expert.isActive).length,\n        totalExperts: experts.length,\n        callsToday: calls.length,\n        declinedCalls: calls.filter((call) => call.callStatus === \"declined\").length,\n        completedCalls: calls.filter((call) => call.callStatus === \"completed\").length,\n        avgDuration: calls.reduce((total, call) => total + call.duration, 0),\n        avgCallRevenue: Math.round(calls.reduce((total, call) => total + call.totalCost, 0)),\n        avgRating: (reviews.reduce((total, review) => total + review.rating, 0) / reviews.length)?.toFixed(1),\n      };\n\n      // ----------------------------------------------------------\n      // Live calls Table [1,2]\n      // ----------------------------------------------------------\n\n      const liveCalls = calls.filter((call) => /ongoing|pending/i.test(call.callStatus)).slice(0, 8).map((call) => {\n        return {\n          id: call.id,\n          documentId: call.documentId,\n          caller: call.caller?.name,\n          expert: call.receiver?.name,\n          type: call.type,\n          startTime: call.startTime,\n          status: call.callStatus,\n          duration: call.duration,\n          category: call.categories?.[0]?.name\n        }\n      });\n\n      if (res) {\n        res.write(`data: ${JSON.stringify({ stats, liveCalls })}\\n\\n`);\n        strapi.plugin('admin-pannel').service('sse').addClient(res);\n      }\n\n      else {\n        strapi.plugin('admin-pannel').service('sse').broadcast({ stats, liveCalls });\n      }\n\n    } catch (error) {\n      strapi.log.error(\"dashboardData error\", error);\n      return { error: error || \"dashboardData failed\" };\n    }\n  },\n});\n\nexport default liveCallsService;","'use strict';\r\n\r\nconst sseService = ({ strapi }) => {\r\n    const clients = new Set();\r\n\r\n    return {\r\n        addClient(res) {\r\n            clients.add(res);\r\n        },\r\n\r\n        removeClient(res) {\r\n            clients.delete(res);\r\n        },\r\n\r\n        broadcast(data) {\r\n            for (const client of clients) {\r\n                if (client.destroyed || client.writableEnded) {\r\n                    clients.delete(client);\r\n                    continue;\r\n                }\r\n                client.write(`data: ${JSON.stringify(data)}\\n\\n`);\r\n            }\r\n        },\r\n    };\r\n};\r\n\r\nexport default sseService;\r\n","import liveCallsService from './liveCallsService';\nimport sse from './sse';\n\nexport default {\n  liveCallsService,\n  sse,\n};\n","/**\n * Application methods\n */\nimport bootstrap from './bootstrap';\nimport destroy from './destroy';\nimport register from './register';\n\n/**\n * Plugin server methods\n */\nimport config from './config';\nimport contentTypes from './content-types';\nimport controllers from './controllers';\nimport middlewares from './middlewares';\nimport policies from './policies';\nimport routes from './routes';\nimport services from './services';\n\nexport default {\n  bootstrap,\n  destroy,\n  register,\n\n  config,\n  controllers,\n  contentTypes,\n  middlewares,\n  policies,\n  routes,\n  services,\n};\n"],"names":["index","config","sse"],"mappings":"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"}